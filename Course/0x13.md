–û—Ç–ª–∏—á–Ω–æ, –≤–ø–µ—Ä–µ–¥ –∫ —Ñ–∞–π–ª–æ–≤—ã–º —Å–∏—Å—Ç–µ–º–∞–º! üìÇ‚ú®

---

### üîπ –£—Ä–æ–∫ 13. –§–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã: –æ—Å–Ω–æ–≤—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

---

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ ‚Äî –∫–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –û–°, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é, —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ –Ω–∞ –¥–∏—Å–∫–∞—Ö –∏ –¥—Ä—É–≥–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö —Ö—Ä–∞–Ω–µ–Ω–∏—è. –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è —Å –æ—Å–Ω–æ–≤–∞–º–∏ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º, –∏—Ö —Ç–∏–ø–∞–º–∏ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π, –∞ —Ç–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑—É–µ–º –ø—Ä–æ—Å—Ç–µ–π—à—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∞—Ç–∞–ª–æ–≥–æ–≤ –∏ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:

* –†–æ–ª—å –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º
* –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∏–ø—ã: FAT, ext2/ext3, NTFS ‚Äî –æ–±–∑–æ—Ä
* –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã: —Å—É–ø–µ—Ä–±–ª–æ–∫, inode, –±–ª–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö
* –†–∞–±–æ—Ç–∞ —Å –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏ –∏ —Ñ–∞–π–ª–∞–º–∏
* –ü—Ä–æ—Å—Ç–µ–π—à–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –¥–∏—Å–∫–µ

---

### –ü—Ä–∏–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ (fs/simplefs.c)

```c
#include <stdint.h>

#define BLOCK_SIZE 512
#define MAX_FILES 128

typedef struct {
    char name[32];
    uint32_t size;
    uint32_t block_start;
} file_entry_t;

typedef struct {
    uint32_t magic;
    uint32_t total_blocks;
    uint32_t free_blocks;
    file_entry_t files[MAX_FILES];
} superblock_t;

superblock_t superblock;

void fs_init()
{
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—É–ø–µ—Ä–±–ª–æ–∫–∞ –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤
    superblock.magic = 0x53465301; // SimpleFS magic number
    superblock.total_blocks = 10000;
    superblock.free_blocks = 9990;
    // –û—á–∏—Å—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤
    for(int i = 0; i < MAX_FILES; i++) {
        superblock.files[i].name[0] = 0;
        superblock.files[i].size = 0;
        superblock.files[i].block_start = 0;
    }
}

int fs_create_file(const char* name, uint32_t size)
{
    // –ü—Ä–æ—Å—Ç–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –º–µ—Å—Ç–∞
    for(int i = 0; i < MAX_FILES; i++) {
        if(superblock.files[i].name[0] == 0) {
            // –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –∏–º—è —Ñ–∞–π–ª–∞ –∏ —Ä–∞–∑–º–µ—Ä—ã
            for(int j = 0; name[j] && j < 31; j++)
                superblock.files[i].name[j] = name[j];
            superblock.files[i].name[31] = 0;
            superblock.files[i].size = size;
            superblock.files[i].block_start = superblock.total_blocks - superblock.free_blocks;
            superblock.free_blocks -= (size + BLOCK_SIZE - 1) / BLOCK_SIZE;
            return 0;
        }
    }
    return -1; // –ù–µ—Ç –º–µ—Å—Ç–∞
}
```

---

### –ü–æ—è—Å–Ω–µ–Ω–∏—è:

* –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Ö—Ä–∞–Ω–∏—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–æ–≤.
* –°—É–ø–µ—Ä–±–ª–æ–∫ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –§–°.
* –í –Ω–∞—à–µ–º –ø—Ä–∏–º–µ—Ä–µ ‚Äî –æ—á–µ–Ω—å –ø—Ä–æ—Å—Ç–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤ –∏ —Å–ª–æ–∂–Ω—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤.
* –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —É–º–µ–Ω—å—à–∞–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –±–ª–æ–∫–æ–≤.
* –≠—Ç–æ –±–∞–∑–∞ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –§–°.

---

### –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ:

* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —Å—É–ø–µ—Ä–±–ª–æ–∫–∞.
* –ù–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∏ –ø–æ–∏—Å–∫–∞ —Ñ–∞–π–ª–æ–≤.
* –î–æ–±–∞–≤–∏—Ç—å —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤.
* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –≤ —ç–º—É–ª—è—Ç–æ—Ä–µ —Å –∏–º–∏—Ç–∞—Ü–∏–µ–π –¥–∏—Å–∫–∞.

---

### –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ –∏ –ø—Ä–∞–∫—Ç–∏–∫—É:

* –¢–µ–æ—Ä–∏—è: 4 —á–∞—Å–∞
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 8 —á–∞—Å–æ–≤

---

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* OSDev Wiki: Filesystems ([https://wiki.osdev.org/Filesystems](https://wiki.osdev.org/Filesystems))
* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ FAT, ext2, NTFS
* –ö–Ω–∏–≥–∏ –ø–æ —Ñ–∞–π–ª–æ–≤—ã–º —Å–∏—Å—Ç–µ–º–∞–º –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞–º –¥–∞–Ω–Ω—ã—Ö

---

### –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –ü–æ—è—Å–Ω–µ–Ω–∏–µ —Ä–æ–ª–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º
* –°–æ–≤–º–µ—Å—Ç–Ω–æ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–π –§–°
* –ü–æ—à–∞–≥–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
* –û–±—Å—É–∂–¥–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π: –∏–Ω–¥–µ–∫—Å—ã, –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –∂—É—Ä–Ω–∞–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

---

–ì–æ—Ç–æ–≤ –¥–≤–∏–≥–∞—Ç—å—Å—è –¥–∞–ª—å—à–µ ‚Äî —Å–µ—Ç–µ–≤–æ–π —Å—Ç–µ–∫ –∏ –æ—Å–Ω–æ–≤—ã —Å–µ—Ç–µ–≤–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è? üåê
