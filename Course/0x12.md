–û—Ç–ª–∏—á–Ω–æ, –¥–≤–∏–≥–∞–µ–º—Å—è –¥–∞–ª—å—à–µ! üîßüíª

---

### üîπ –£—Ä–æ–∫ 12. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–æ–≤

---

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–î–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º –æ–±–µ—Å–ø–µ—á–µ–Ω–∏–µ–º –û–° –Ω—É–∂–Ω—ã –¥—Ä–∞–π–≤–µ—Ä—ã ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∫–æ—Ç–æ—Ä—ã–µ —É–ø—Ä–∞–≤–ª—è—é—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –∏—Ö —Ä–∞–±–æ—Ç—É –≤ —Å–∏—Å—Ç–µ–º–µ. –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –ø–æ–∑–Ω–∞–∫–æ–º–∏–º—Å—è —Å –ø—Ä–∏–Ω—Ü–∏–ø–∞–º–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –¥—Ä–∞–π–≤–µ—Ä–æ–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–¥—Ä–∞, –∏–∑—É—á–∏–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å —à–∏–Ω–∞–º–∏ PCI, —Ä–∞–±–æ—Ç—É —Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:

* –ß—Ç–æ —Ç–∞–∫–æ–µ –¥—Ä–∞–π–≤–µ—Ä—ã –∏ –∑–∞—á–µ–º –æ–Ω–∏ –Ω—É–∂–Ω—ã
* –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ —É—Ä–æ–≤–Ω–∏ –¥—Ä–∞–π–≤–µ—Ä–æ–≤
* –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –∞–ø–ø–∞—Ä–∞—Ç—É—Ä–æ–π —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç—ã –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ –∏ MMIO
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã—Ö –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤
* –†–∞–±–æ—Ç–∞ —Å PCI-—à–∏–Ω–æ–π –∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤

---

### –ü—Ä–∏–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ (drivers/pci.c)

```c
#include <stdint.h>

#define PCI_CONFIG_ADDRESS 0xCF8
#define PCI_CONFIG_DATA    0xCFC

uint32_t pci_read_config(uint8_t bus, uint8_t slot, uint8_t func, uint8_t offset)
{
    uint32_t address = (1U << 31) | (bus << 16) | (slot << 11) | (func << 8) | (offset & 0xFC);
    *(volatile uint32_t*)PCI_CONFIG_ADDRESS = address;
    return *(volatile uint32_t*)PCI_CONFIG_DATA;
}

void pci_scan_bus()
{
    for(uint8_t bus = 0; bus < 256; bus++)
    {
        for(uint8_t slot = 0; slot < 32; slot++)
        {
            uint16_t vendor_id = pci_read_config(bus, slot, 0, 0) & 0xFFFF;
            if(vendor_id != 0xFFFF)
            {
                // –£—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–æ, –º–æ–∂–Ω–æ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –¥—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            }
        }
    }
}
```

---

### –ü–æ—è—Å–Ω–µ–Ω–∏—è:

* PCI-—à–∏–Ω–∞ ‚Äî —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —à–∏–Ω–∞ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤, –¥—Ä–∞–π–≤–µ—Ä—ã –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É—é—Ç —Å –Ω–µ–π –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.
* –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–º—É –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤—É PCI –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ.
* –î—Ä–∞–π–≤–µ—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏ —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç—ã –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ (I/O ports) –∏–ª–∏ –ø–∞–º—è—Ç—å.
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –≤–∞–∂–Ω–∞ –¥–ª—è —Å–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ —Å–æ–±—ã—Ç–∏—è.

---

### –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ:

* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ PCI-—à–∏–Ω—ã –∏ –≤—ã–≤–æ–¥ —Å–ø–∏—Å–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤.
* –ù–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π –¥—Ä–∞–π–≤–µ—Ä –¥–ª—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–π–º–µ—Ä–∞ –∏–ª–∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã).
* –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –æ—Ç —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.
* –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –¥—Ä–∞–π–≤–µ—Ä–∞ –≤ —ç–º—É–ª—è—Ç–æ—Ä–µ QEMU.

---

### –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ –∏ –ø—Ä–∞–∫—Ç–∏–∫—É:

* –¢–µ–æ—Ä–∏—è: 4 —á–∞—Å–∞
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 8 —á–∞—Å–æ–≤

---

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* OSDev Wiki: PCI Bus ([https://wiki.osdev.org/PCI](https://wiki.osdev.org/PCI))
* Intel SDM: —Ä–∞–∑–¥–µ–ª—ã –ø—Ä–æ PCI –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏
* –ö–Ω–∏–≥–∏ –∏ —Å—Ç–∞—Ç—å–∏ –ø–æ –¥—Ä–∞–π–≤–µ—Ä–∞–º –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ –û–°

---

### –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã PCI –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º
* –ü–æ—à–∞–≥–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –¥—Ä–∞–π–≤–µ—Ä–∞
* –°–æ–≤–º–µ—Å—Ç–Ω–∞—è –æ—Ç–ª–∞–¥–∫–∞ –Ω–∞ QEMU
* –û–±—Å—É–∂–¥–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥—Ä–∞–π–≤–µ—Ä–æ–≤ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

---

–ì–æ—Ç–æ–≤ –∫ —É—Ä–æ–∫—É 13 ‚Äî —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã: –æ—Å–Ω–æ–≤—ã –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è? üìÅ
