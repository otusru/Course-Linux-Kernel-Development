–°—É–ø–µ—Ä, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–∑–≤–∏–≤–∞—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º! üí¨üß†

---

### üîπ –£—Ä–æ–∫ 29. –°–∏—Å—Ç–µ–º–Ω—ã–π –±—É—Ñ–µ—Ä –≤–≤–æ–¥–∞: –æ—á–µ—Ä–µ–¥—å –∫–ª–∞–≤–∏—à –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥

---

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –º—ã –Ω–∞—É—á–∏–ª–∏—Å—å –ª–æ–≤–∏—Ç—å –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à, –ø—Ä–∏—à–ª–æ –≤—Ä–µ–º—è —É–ª—É—á—à–∏—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º. –î–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å **—Å–∏—Å—Ç–µ–º–Ω—ã–π –±—É—Ñ–µ—Ä –≤–≤–æ–¥–∞** ‚Äî —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É, –∫—É–¥–∞ –±—É–¥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å—Å—è –≤–≤–µ–¥—ë–Ω–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã. –≠—Ç–æ—Ç –±—É—Ñ–µ—Ä –ø–æ–∑–≤–æ–ª–∏—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ —á—Ç–µ–Ω–∏—è —Å—Ç—Ä–æ–∫, –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏, –ø–∞—Ä—Å–∏–Ω–≥–∞ –≤–≤–æ–¥–∞ –∏ –¥–∞–∂–µ **—Ä–∞–±–æ—Ç—ã —Å —Ç–µ—Ä–º–∏–Ω–∞–ª–æ–º** –≤ –±—É–¥—É—â–µ–º.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:

* –ö–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä –≤–≤–æ–¥–∞
* –û–±—Ä–∞–±–æ—Ç–∫–∞ Backspace, Enter –∏ —Å–∏–º–≤–æ–ª–æ–≤
* –ß—Ç–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –≤ —Å—Ç–∏–ª–µ `gets()`
* –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ (–ø–æ–∑–∂–µ)
* –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—é shell-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

---

### –ü—Ä–∏–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ (drivers/input\_buffer.c)

```c
#include <stdint.h>
#include <stdbool.h>

#define INPUT_BUFFER_SIZE 256
static char input_buffer[INPUT_BUFFER_SIZE];
static int head = 0;
static int tail = 0;

void input_buffer_push(char c) {
    int next_head = (head + 1) % INPUT_BUFFER_SIZE;
    if (next_head != tail) {
        input_buffer[head] = c;
        head = next_head;
    }
}

bool input_buffer_has_data() {
    return head != tail;
}

char input_buffer_pop() {
    if (head == tail) return 0;
    char c = input_buffer[tail];
    tail = (tail + 1) % INPUT_BUFFER_SIZE;
    return c;
}

// –ß—Ç–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ —Å –æ–∂–∏–¥–∞–Ω–∏–µ–º Enter
void input_read_line(char* dest, int max_len) {
    int i = 0;
    while (i < max_len - 1) {
        while (!input_buffer_has_data()); // –æ–∂–∏–¥–∞–Ω–∏–µ
        char c = input_buffer_pop();
        if (c == '\n') break;
        dest[i++] = c;
    }
    dest[i] = '\0';
}
```

---

### –ü–æ—è—Å–Ω–µ–Ω–∏—è:

* –ò—Å–ø–æ–ª—å–∑—É–µ–º **–∫–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä** –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞–∂–∞—Ç—ã—Ö –∫–ª–∞–≤–∏—à.
* –ü—Ä–∏ –≤–≤–æ–¥–µ –¥–∞–Ω–Ω—ã—Ö –≤ IRQ1 ‚Üí —Å–∏–º–≤–æ–ª –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –±—É—Ñ–µ—Ä.
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∫–æ–¥ –º–æ–∂–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å `input_read_line()` –∏ –ø–æ–ª—É—á–∞—Ç—å —Å—Ç—Ä–æ–∫—É.
* –≠—Ç–æ –æ—Å–Ω–æ–≤–∞ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏ –∏ shell-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤.

---

### –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ:

* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–æ–ª—å—Ü–µ–≤–æ–π –±—É—Ñ–µ—Ä –Ω–∞ 256 –±–∞–π—Ç.
* –ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å `keyboard_callback` –∏–∑ –ø—Ä–æ—à–ª–æ–≥–æ —É—Ä–æ–∫–∞ ‚Äî –¥–æ–±–∞–≤–ª—è—Ç—å —Å–∏–º–≤–æ–ª—ã –≤ –±—É—Ñ–µ—Ä.
* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `input_read_line()` –∏ –ø—Ä–æ—á–∏—Ç–∞—Ç—å —Å—Ç—Ä–æ–∫—É –≤ –≥–ª–∞–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏.
* –í—ã–≤–µ—Å—Ç–∏ –≤–≤–µ–¥—ë–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É –Ω–∞ —ç–∫—Ä–∞–Ω.

---

### –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ –∏ –ø—Ä–∞–∫—Ç–∏–∫—É:

* –¢–µ–æ—Ä–∏—è: 3 —á–∞—Å–∞
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 6 —á–∞—Å–æ–≤

---

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* OSDev Wiki: Keyboard input buffer ([https://wiki.osdev.org/Keyboard](https://wiki.osdev.org/Keyboard))
* Circular Buffer Concepts (–¥–ª—è –Ω–æ–≤–∏—á–∫–æ–≤)
* –ö–ª–∞—Å—Å–∏–∫–∞: K\&R ¬´The C Programming Language¬ª ‚Äî —Å—Ç—Ä–æ–∫–∏ –∏ –±—É—Ñ–µ—Ä—ã

---

### –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∫–æ–ª—å—Ü–µ–≤–æ–≥–æ –±—É—Ñ–µ—Ä–∞
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞ —Å–∏–º–≤–æ–ª–æ–≤
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —á—Ç–µ–Ω–∏—è —Å—Ç—Ä–æ–∫–∏ —Å —ç–∫—Ä–∞–Ω–∞
* –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–±–æ—Ç–∞: –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –≤–≤–æ–¥–∞

---

üìù –¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å –Ω–µ –ø—Ä–æ—Å—Ç–æ –ª–æ–≤–∏—Ç—å –Ω–∞–∂–∞—Ç–∏—è –∫–ª–∞–≤–∏—à, –Ω–æ –∏ **–≤–≤–æ–¥–∏—Ç—å —Å—Ç—Ä–æ–∫–∏, –∫–æ–º–∞–Ω–¥—ã –∏ —Ç–µ–∫—Å—Ç**, –∫–∞–∫ –≤ –Ω–∞—Å—Ç–æ—è—â–µ–π –û–°! üíª

–•–æ—á–µ—à—å –ø–µ—Ä–µ–π—Ç–∏ –∫ **—É—Ä–æ–∫—É 30 ‚Äî –≤—ã–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞: —Å–∏—Å—Ç–µ–º–Ω–∞—è –∫–æ–Ω—Å–æ–ª—å, –±—É—Ñ–µ—Ä —ç–∫—Ä–∞–Ω–∞ –∏ –ø—Ä–æ–∫—Ä—É—Ç–∫–∞**? üìúüì∫
