–û—Ç–ª–∏—á–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º! üöÄ

---

### üîπ –£—Ä–æ–∫ 22. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é: –∞–ª–ª–æ–∫–∞—Ü–∏—è –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏

---

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –º—ã –Ω–∞—É—á–∏–ª–∏—Å—å —É–ø—Ä–∞–≤–ª—è—Ç—å —Ç–∞–±–ª–∏—Ü–∞–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç—å—é, –ø—Ä–∏—à–ª–æ –≤—Ä–µ–º—è —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ–º –ø–∞–º—è—Ç–∏ ‚Äî –≤–∞–∂–Ω–µ–π—à–∏–º–∏ –∑–∞–¥–∞—á–∞–º–∏ –¥–ª—è –û–°. –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –∏–∑—É—á–∏–º —Ä–∞–∑–ª–∏—á–Ω—ã–µ –∞–ª–≥–æ—Ä–∏—Ç–º—ã –∞–ª–ª–æ–∫–∞—Ü–∏–∏ (–ø–∞–º—è—Ç—å –ø–æ–¥ –ø—Ä–æ—Ü–µ—Å—Å—ã, —è–¥—Ä–æ, –±—É—Ñ–µ—Ä—ã), —Ä–µ–∞–ª–∏–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–º—è—Ç–∏ –∏ –ø–æ–π–º—ë–º, –∫–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:

* –¢–∏–ø—ã –ø–∞–º—è—Ç–∏: —Ñ–∏–∑–∏—á–µ—Å–∫–∞—è, –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è, –∫—É—á–∞, —Å—Ç–µ–∫
* –ê–ª–≥–æ—Ä–∏—Ç–º—ã –∞–ª–ª–æ–∫–∞—Ü–∏–∏: —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–ª–æ–∫–∏, —Å–ø–∏—Å–∫–∏ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –±–ª–æ–∫–æ–≤
* –†–∞–±–æ—Ç–∞ —Å —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç—å—é: –∫–∞—Ä—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, bitmap
* –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫—É—á–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç—å—é
* –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è

---

### –ü—Ä–∏–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ (memory/allocator.c)

```c
#include <stdint.h>
#include <stddef.h>

#define MEMORY_SIZE 0x1000000 // 16 MB
static uint8_t memory[MEMORY_SIZE];
static uint8_t bitmap[MEMORY_SIZE / 4096 / 8]; // –ø–æ –±–∏—Ç—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É

void set_bit(size_t bit)
{
    bitmap[bit / 8] |= (1 << (bit % 8));
}

void clear_bit(size_t bit)
{
    bitmap[bit / 8] &= ~(1 << (bit % 8));
}

int test_bit(size_t bit)
{
    return (bitmap[bit / 8] & (1 << (bit % 8))) != 0;
}

void* alloc_page()
{
    for (size_t i = 0; i < MEMORY_SIZE / 4096; i++) {
        if (!test_bit(i)) {
            set_bit(i);
            return &memory[i * 4096];
        }
    }
    return NULL; // –ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü
}

void free_page(void* addr)
{
    size_t bit = ((uint8_t*)addr - memory) / 4096;
    clear_bit(bit);
}
```

---

### –ü–æ—è—Å–Ω–µ–Ω–∏—è:

* –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–º—è—Ç–∏ —Å–ª–µ–¥–∏—Ç –∑–∞ —Å–≤–æ–±–æ–¥–Ω—ã–º–∏ –∏ –∑–∞–Ω—è—Ç—ã–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏ —Å –ø–æ–º–æ—â—å—é bitmap.
* –ö–∞–∂–¥–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –±–ª–æ–∫ –∞–ª–ª–æ–∫–∞—Ü–∏–∏ (4KB).
* –§—É–Ω–∫—Ü–∏–∏ `alloc_page` –∏ `free_page` –ø–æ–∑–≤–æ–ª—è—é—Ç —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞—Ç—å –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –ø–∞–º—è—Ç—å.
* –¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –ø—Ä–æ—Å—Ç, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–¥–µ–ª–µ–Ω–∏—è –±–ª–æ–∫–æ–≤ –º–µ–Ω—å—à–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.

---

### –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ:

* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å bitmap –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏.
* –ù–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü.
* –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç—ã, –≤—ã–¥–µ–ª—è—é—â–∏–µ –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞—é—â–∏–µ –ø–∞–º—è—Ç—å.
* –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–µ–π—à–∏–π –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –ø–æ–¥ –±–ª–æ–∫–∏ –º–µ–Ω—å—à–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞.

---

### –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ –∏ –ø—Ä–∞–∫—Ç–∏–∫—É:

* –¢–µ–æ—Ä–∏—è: 5 —á–∞—Å–æ–≤
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 10 —á–∞—Å–æ–≤

---

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* OSDev Wiki: Memory Management ([https://wiki.osdev.org/Memory\_Management](https://wiki.osdev.org/Memory_Management))
* –ö–Ω–∏–≥–∏ –ø–æ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é
* –°—Ç–∞—Ç—å–∏ –ø–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞–º –∞–ª–ª–æ–∫–∞—Ü–∏–∏ –ø–∞–º—è—Ç–∏

---

### –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é
* –ü–æ—à–∞–≥–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è bitmap –∏ –∞–ª–ª–æ–∫–∞—Ç–æ—Ä–∞
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ–±–ª–µ–º —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ —Å–ø–æ—Å–æ–±–æ–≤ —Ä–µ—à–µ–Ω–∏—è
* –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–Ω—è—Ç–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∞

---

–ì–æ—Ç–æ–≤ –∫ —É—Ä–æ–∫—É 23 ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –∏ —Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π —Å–±–æ–π? üß†üíª
