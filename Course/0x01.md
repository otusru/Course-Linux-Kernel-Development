–û—Ç–ª–∏—á–Ω–æ! üöÄ –ü–æ–µ—Ö–∞–ª–∏ —Å —É—Ä–æ–∫–∞ 1 ‚Äî –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å –ø–æ–¥—Ä–æ–±–Ω—ã–π –ø—Ä–∏–º–µ—Ä –Ω–∞ C23 —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏, –ø–æ—è—Å–Ω–µ–Ω–∏—è–º–∏ –∏ —à–∞–≥ –∑–∞ —à–∞–≥–æ–º —Ä–∞–∑–±–∏—Ä–∞—Ç—å—Å—è –≤ –∫–æ–¥–µ.

---

### üîπ –£—Ä–æ–∫ 1. –ó–∞–≥—Ä—É–∑—á–∏–∫ –û–°: –ø–µ—Ä–≤—ã–π —ç—Ç–∞–ø ‚Äî —Ä–µ–∞–ª—å–Ω—ã–π —Ä–µ–∂–∏–º x86 –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ protected mode

---

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –Ω–∞—á–Ω–µ–º —Å —Å–∞–º–æ–≥–æ –≤–∞–∂–Ω–æ–≥–æ ‚Äî –∑–∞–≥—Ä—É–∑—á–∏–∫–∞. –ù–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ x86-64 –∫–æ–º–ø—å—é—Ç–µ—Ä —Å—Ç–∞—Ä—Ç—É–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ (Real Mode), —Å–æ–≤–º–µ—Å—Ç–∏–º–æ–º —Å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞–º–∏ Intel 8086. –¶–µ–ª—å ‚Äî –Ω–∞–ø–∏—Å–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫ –Ω–∞ –∞—Å—Å–µ–º–±–ª–µ—Ä–µ, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç –±–∞–∑–æ–≤—ã–µ –¥–µ–π—Å—Ç–≤–∏—è: –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –≤ protected mode (32-–±–∏—Ç–Ω—ã–π —Ä–µ–∂–∏–º —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏), –∑–∞—Ç–µ–º –≥–æ—Ç–æ–≤–∏—Ç —Å–∏—Å—Ç–µ–º—É –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —è–¥—Ä–∞ –Ω–∞ C.

–ú—ã —É–≤–∏–¥–∏–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞, –ø–æ—á–µ–º—É –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç—å—Å—è –∏–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ –≤ protected mode, –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏–º –æ—Å–Ω–æ–≤—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —è–¥—Ä–∞.

---

### –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (boot/boot.asm)

```asm
; boot.asm ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫ –≤ —Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ
; –≠—Ç–æ—Ç –∫–æ–¥ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è BIOS –∏ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –≤ –ø–µ—Ä–≤—ã—Ö 512 –±–∞–π—Ç–∞—Ö –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞.

[org 0x7C00]          ; –ê–¥—Ä–µ—Å, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É BIOS –∑–∞–≥—Ä—É–∂–∞–µ—Ç –∑–∞–≥—Ä—É–∑—á–∏–∫

start:
    cli               ; –ó–∞–ø—Ä–µ—Ç–∏—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    xor ax, ax
    mov ds, ax        ; –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤
    mov es, ax
    mov ss, ax
    mov sp, 0x7C00    ; –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–µ–∫–∞

    ; –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã BIOS (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –ø–æ–ª–µ–∑–Ω–æ)
    mov si, boot_sig
    call check_bios_sig

    ; –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å —è–¥—Ä–æ –≤ –ø–∞–º—è—Ç—å (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –¥–∏—Å–∫–∞)

    ; –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ protected mode
    call enter_protected_mode

halt:
    hlt               ; –û—Å—Ç–∞–Ω–æ–≤ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
    jmp halt

; --- –ü—Ä–æ—Ü–µ–¥—É—Ä—ã ---

check_bios_sig:
    ; –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä—ã BIOS –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∑–∞–≥—Ä—É–∑–∫–∏
    ret

enter_protected_mode:
    ; –í–∫–ª—é—á–∞–µ–º PE-bit –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ CR0
    mov eax, cr0
    or eax, 1
    mov cr0, eax

    ; –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–æ–≤ –Ω–∞ GDT (–≥–ª–æ–±–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤)
    ; (–±—É–¥–µ—Ç –æ–ø–∏—Å–∞–Ω–æ –≤ —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ)

    ; –ü–µ—Ä–µ—Ö–æ–¥ –≤ protected mode ‚Äî –ø—Ä—ã–∂–æ–∫ –∫ 32-–±–∏—Ç–Ω–æ–º—É –∫–æ–¥—É
    jmp 0x08:pm_start

pm_start:
    ; –ó–¥–µ—Å—å –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è 32-–±–∏—Ç–Ω—ã–π –∫–æ–¥ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞
    cli
    ; –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ–≥–º–µ–Ω—Ç–æ–≤ –∏ —Å—Ç–µ–∫–∞ –≤ protected mode

    ; –î–∞–ª–µ–µ –º–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —è–¥—Ä–æ –∏ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

    ret

boot_sig db 0x55, 0xAA       ; –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —Å–µ–∫—Ç–æ—Ä–∞
times 510 - ($ - $$) db 0    ; –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –¥–æ 510 –±–∞–π—Ç
dw 0xAA55                   ; –ü–æ–¥–ø–∏—Å—å 0xAA55
```

---

### –ü–æ—è—Å–Ω–µ–Ω–∏—è:

* –ó–∞–≥—Ä—É–∑—á–∏–∫ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ –∞–¥—Ä–µ—Å–µ 0x7C00 ‚Äî —ç—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç –¥–ª—è BIOS.
* –í –Ω–∞—á–∞–ª–µ –æ—Ç–∫–ª—é—á–∞–µ–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (cli) ‚Äî —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–±–æ–µ–≤.
* –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–µ–≥–º–µ–Ω—Ç—ã –∏ —Å—Ç–µ–∫.
* –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–∏–≥–Ω–∞—Ç—É—Ä—É BIOS (0x55AA) ‚Äî —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞–≥—Ä—É–∑—á–∏–∫ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.
* –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ protected mode ‚Äî –∫–ª—é—á–µ–≤–æ–π —à–∞–≥ –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π —Ä–∞–±–æ—Ç—ã —Å 32-–±–∏—Ç–Ω—ã–º –∫–æ–¥–æ–º –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏.
* –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–≥—Ä—É–∑–∫–µ —è–¥—Ä–∞ –∏ –ø–µ—Ä–µ–¥–∞—á–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

---

### –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ:

* –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–æ–±—Ä–∞—Ç—å —ç—Ç–æ—Ç –∑–∞–≥—Ä—É–∑—á–∏–∫ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ–º–æ—â—å—é NASM).
* –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ —ç–º—É–ª—è—Ç–æ—Ä–µ QEMU –∏–ª–∏ Bochs.
* –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∑–∞–≥—Ä—É–∑—á–∏–∫ —Å—Ç–∞—Ä—Ç—É–µ—Ç –∏ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–æ–∫.
* –ò–∑—É—á–∏—Ç—å –∏ –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–¥, –¥–æ–±–∞–≤–∏–≤ –≤—ã–≤–æ–¥ –≤ –ø–æ—Ä—Ç COM –∏–ª–∏ –Ω–∞ —ç–∫—Ä–∞–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ BIOS –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è) ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ.

---

### –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ –∏ –ø—Ä–∞–∫—Ç–∏–∫—É:

* –¢–µ–æ—Ä–∏—è: 2 —á–∞—Å–∞
* –ü—Ä–∞–∫—Ç–∏–∫–∞ (—Å–±–æ—Ä–∫–∞, –∑–∞–ø—É—Å–∫, —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç—ã): 4 —á–∞—Å–∞

---

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* –ö–Ω–∏–≥–∞: "Operating Systems: From 0 to 1" (Eli Bendersky)
* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Intel: Intel 64 and IA-32 Architectures Software Developer‚Äôs Manual
* –û–Ω–ª–∞–π–Ω: OSDev Wiki ([https://wiki.osdev.org/Real\_Mode](https://wiki.osdev.org/Real_Mode))
* –í–∏–¥–µ–æ: "How does the bootloader work?" –Ω–∞ YouTube

---

### –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –õ–µ–∫—Ü–∏—è —Å –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–µ–π: –ø–æ–∫–∞–∑–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç BIOS, –∑–∞—á–µ–º real -> protected mode
* –ñ–∏–≤–æ–π —Ä–∞–∑–±–æ—Ä –∫–æ–¥–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ –≤ —ç–º—É–ª—è—Ç–æ—Ä–µ –∏ –æ—Ç–ª–∞–¥–∫–∞ —Å GDB/QEMU
* –û–±—Å—É–∂–¥–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏ –≤–æ–ø—Ä–æ—Å–æ–≤

---

–ï—Å–ª–∏ –≥–æ—Ç–æ–≤, —è –º–æ–≥—É –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ —É—Ä–æ–∫—É 2 ‚Äî –Ω–∞–ø—Ä–∏–º–µ—Ä, —Å –ø–æ–¥–≥–æ—Ç–æ–≤–∫–æ–π —Ç–∞–±–ª–∏—Ü—ã GDT –∏ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º –∑–∞–≥—Ä—É–∑—á–∏–∫–∞!
–ß—Ç–æ —Å–∫–∞–∂–µ—à—å? üòä
