–°—É–ø–µ—Ä! –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ –≤–∞–∂–Ω–µ–π—à–µ–π —Ç–µ–º–µ —è–¥—Ä–∞ ‚Äî –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è! ‚ö°üß†

---

### üîπ –£—Ä–æ–∫ 25. –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è: –∫–æ–Ω—Ü–µ–ø—Ü–∏—è, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞

---

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è ‚Äî —ç—Ç–æ —Å–ø–æ—Å–æ–±, —Å –ø–æ–º–æ—â—å—é –∫–æ—Ç–æ—Ä–æ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏–ª–∏ —Å–∞–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –º–æ–≥—É—Ç –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—É—â—É—é —Ä–∞–±–æ—Ç—É –∏ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–∑–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏—è. –≠—Ç–æ –æ—Å–Ω–æ–≤–∞ —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –û–°. –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑–±–µ—Ä—ë–º, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –≤ x86-64, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è IDT (—Ç–∞–±–ª–∏—Ü–∞ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π), –∏ –∫–∞–∫ –û–° –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–Ω–µ—à–Ω–∏–µ –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:

* –¢–∏–ø—ã –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π: –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ, –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ, –∏—Å–∫–ª—é—á–µ–Ω–∏—è
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π: IDT –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
* CPU –∏ PIC/APIC: –∫—Ç–æ –∑–∞ —á—Ç–æ –æ—Ç–≤–µ—á–∞–µ—Ç
* –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –≤—ã–∑–æ–≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
* –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∏ –¥—Ä—É–≥–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞

---

### –ü—Ä–∏–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ (interrupts/idt.c)

```c
#include <stdint.h>

typedef struct {
    uint16_t offset_low;
    uint16_t selector;
    uint8_t ist;
    uint8_t type_attr;
    uint16_t offset_mid;
    uint32_t offset_high;
    uint32_t zero;
} __attribute__((packed)) idt_entry_t;

#define IDT_ENTRIES 256
idt_entry_t idt[IDT_ENTRIES];

extern void load_idt(uint64_t idt_ptr);

void set_idt_entry(int vector, void* isr, uint8_t flags) {
    uint64_t addr = (uint64_t)isr;
    idt[vector].offset_low  = addr & 0xFFFF;
    idt[vector].selector    = 0x08; // –°–µ–ª–µ–∫—Ç–æ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞ –∫–æ–¥–∞
    idt[vector].ist         = 0;
    idt[vector].type_attr   = flags;
    idt[vector].offset_mid  = (addr >> 16) & 0xFFFF;
    idt[vector].offset_high = (addr >> 32) & 0xFFFFFFFF;
    idt[vector].zero        = 0;
}
```

---

### –ü–æ—è—Å–Ω–µ–Ω–∏—è:

* IDT (Interrupt Descriptor Table) ‚Äî —Ç–∞–±–ª–∏—Ü–∞ —Å —É–∫–∞–∑–∞—Ç–µ–ª—è–º–∏ –Ω–∞ —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.
* –ö–∞–∂–¥—ã–π –≤–µ–∫—Ç–æ—Ä (0‚Äì255) —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º—É –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—é.
* –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–æ–±—ã—Ç–∏—è –≤ IDT —É–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∞–¥—Ä–µ—Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—ã–∑–æ–≤–∞.
* –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ–ª–∂–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç (—Ä–µ–≥–∏—Å—Ç—Ä—ã –∏ —Ñ–ª–∞–≥–∏).

---

### –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ:

* –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑–æ–≤—É—é IDT —Å 256 –≤–µ–∫—Ç–æ—Ä–∞–º–∏.
* –ù–∞–ø–∏—Å–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∞–π–º–µ—Ä, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞).
* –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∏—Ö —Ä–∞–±–æ—Ç—É —á–µ—Ä–µ–∑ QEMU.
* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π –¥–∏—Å–ø–µ—Ç—á–µ—Ä –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π.

---

### –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ –∏ –ø—Ä–∞–∫—Ç–∏–∫—É:

* –¢–µ–æ—Ä–∏—è: 6 —á–∞—Å–æ–≤
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 10 —á–∞—Å–æ–≤

---

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* OSDev Wiki: Interrupts ([https://wiki.osdev.org/Interrupts](https://wiki.osdev.org/Interrupts))
* Intel¬Æ SDM Vol. 3: Chapter on Interrupt and Exception Handling
* –í–∏–¥–µ–æ–ª–µ–∫—Ü–∏–∏ –∏ —Å—Ç–∞—Ç—å–∏ –ø–æ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é

---

### –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –ü–æ—è—Å–Ω–µ–Ω–∏–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
* –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ IDT –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è ISR
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã —Å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ–º
* –ü—Ä–∞–∫—Ç–∏–∫–∞ —Å QEMU –∏ —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–æ–π

---

üéâ –° —ç—Ç–∏–º —É—Ä–æ–∫–æ–º —Ç—ã –ø–æ–¥–æ—à—ë–ª –∫ —Ä—É–±–µ–∂—É ‚Äî —Ç–µ–ø–µ—Ä—å —Ç–≤–æ—è –û–° –º–æ–∂–µ—Ç **—Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ —Å–æ–±—ã—Ç–∏—è** –∏ —É–ø—Ä–∞–≤–ª—è—Ç—å –∏–º–∏! –í —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ ‚Äî —É–≥–ª—É–±–ª—ë–Ω–Ω–æ –∑–∞–π–º—ë–º—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Ç–∞–π–º–µ—Ä–∞ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ–º —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ç–∏–∫–∞ ‚è±Ô∏è

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —É—Ä–æ–∫—É 26?
