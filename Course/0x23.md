–û—Ç–ª–∏—á–Ω–æ, –ø–æ–≥—Ä—É–∂–∞–µ–º—Å—è –¥–∞–ª—å—à–µ! üöÄ

---

### üîπ –£—Ä–æ–∫ 23. –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–±–æ–µ–≤ (Page Faults)

---

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å ‚Äî –º–æ—â–Ω—ã–π –º–µ—Ö–∞–Ω–∏–∑–º, –Ω–æ –ø—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–µ–æ—Ç–æ–±—Ä–∞–∂—ë–Ω–Ω—ã–º –∏–ª–∏ –∑–∞—â–∏—â—ë–Ω–Ω—ã–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ ‚Äî —Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π —Å–±–æ–π. –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –∏–∑—É—á–∏–º, –∫–∞–∫ –û–° –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –∑–∞–≥—Ä—É–∂–∞–µ—Ç –Ω—É–∂–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞—â–∏—Ç—É –ø–∞–º—è—Ç–∏.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:

* –ß—Ç–æ —Ç–∞–∫–æ–µ —Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π —Å–±–æ–π –∏ –ø–æ—á–µ–º—É –æ–Ω –≤–æ–∑–Ω–∏–∫–∞–µ—Ç
* –ú–µ—Ö–∞–Ω–∏–∑–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã (Page Fault Interrupt)
* –ö–æ–¥—ã –æ—à–∏–±–æ–∫ —Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–≥–æ —Å–±–æ—è (–ø—Ä–∏—á–∏–Ω–∞ –∏ —Ç–∏–ø –¥–æ—Å—Ç—É–ø–∞)
* –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –∏ —Å–≤–æ–ø–ø–∏–Ω–≥ (–æ–±–∑–æ—Ä)
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ Page Fault –≤ —è–¥—Ä–µ

---

### –ü—Ä–∏–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ (interrupts/page\_fault.c)

```c
#include <stdint.h>
#include <stdio.h>

// –†–µ–≥–∏—Å—Ç—Ä CR2 —Ö—Ä–∞–Ω–∏—Ç –∞–¥—Ä–µ—Å, –≤—ã–∑–≤–∞–≤—à–∏–π Page Fault
extern uint64_t read_cr2(void);

void page_fault_handler(void* regs)
{
    uint64_t faulting_address = read_cr2();

    // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –æ—à–∏–±–∫—É (–∫–æ–¥ –≤ —Ä–µ–≥–∏—Å—Ç—Ä–µ error code)
    // –î–ª—è –ø—Ä–æ—Å—Ç–æ—Ç—ã ‚Äî –≤—ã–≤–æ–¥–∏–º –∞–¥—Ä–µ—Å –∏ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–∏—Å—Ç–µ–º—É
    printf("Page fault at address: 0x%lx\n", faulting_address);

    // –í —Ä–µ–∞–ª—å–Ω–æ–π –û–° ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –≤—ã–¥–∞—á–∞ –æ—à–∏–±–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å—É –∏ —Ç.–¥.
    while(1); // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
}
```

---

### –ü–æ—è—Å–Ω–µ–Ω–∏—è:

* CR2 ‚Äî —Ä–µ–≥–∏—Å—Ç—Ä, –≤ –∫–æ—Ç–æ—Ä–æ–º —Ö—Ä–∞–Ω–∏—Ç—Å—è –∞–¥—Ä–µ—Å, –≤—ã–∑–≤–∞–≤—à–∏–π –æ—à–∏–±–∫—É.
* –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–¥ –æ—à–∏–±–∫–∏ –∏ –∞–¥—Ä–µ—Å —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
* –û–° –¥–æ–ª–∂–Ω–∞ —Ä–µ—à–∏—Ç—å, –∫–∞–∫ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å: –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É, —É–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –∏–ª–∏ –≤—ã–¥–∞—Ç—å –æ—à–∏–±–∫—É.
* –≠—Ç–æ –æ—Å–Ω–æ–≤–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–∞–º—è—Ç—å—é –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é.

---

### –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ:

* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ Page Fault.
* –í—ã–≤–µ—Å—Ç–∏ –∞–¥—Ä–µ—Å, –≤—ã–∑–≤–∞–≤—à–∏–π –æ—à–∏–±–∫—É.
* –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –Ω–µ–æ—Ç–æ–±—Ä–∞–∂—ë–Ω–Ω–æ–π –ø–∞–º—è—Ç–∏.
* –ü—Ä–æ–¥—É–º–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é –ª–æ–≥–∏–∫—É –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü (–µ—Å–ª–∏ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å).

---

### –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ –∏ –ø—Ä–∞–∫—Ç–∏–∫—É:

* –¢–µ–æ—Ä–∏—è: 4 —á–∞—Å–∞
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 8 —á–∞—Å–æ–≤

---

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* Intel¬Æ Software Developer‚Äôs Manual, Volume 3
* OSDev Wiki: Page Fault ([https://wiki.osdev.org/Page\_Fault](https://wiki.osdev.org/Page_Fault))
* –°—Ç–∞—Ç—å–∏ –ø–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è–º

---

### –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –ü–æ—è—Å–Ω–µ–Ω–∏–µ –ø—Ä–∏—á–∏–Ω—ã —Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–≥–æ —Å–±–æ—è
* –ü–æ–∫–∞–∑ –∫–æ–¥–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
* –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–Ω—è—Ç–∏—è —Å QEMU –∏ –æ—Ç–ª–∞–¥—á–∏–∫–æ–º
* –û–±—Å—É–∂–¥–µ–Ω–∏–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

---

–ì–æ—Ç–æ–≤—ã –∫ —É—Ä–æ–∫—É 24 ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–≤–æ–¥–æ–º-–≤—ã–≤–æ–¥–æ–º –∏ –ø–æ—Ä—Ç–∞–º–∏? üéÆ‚å®Ô∏è
