–û—Ç–ª–∏—á–Ω–æ, –∏–¥–µ–º –¥–∞–ª—å—à–µ! üöÄ‚ú®

---

### üîπ –£—Ä–æ–∫ 16. –ü—Ä–æ—Ç–æ–∫–æ–ª TCP: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è–º–∏ –∏ –Ω–∞–¥–µ–∂–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞

---

**–û–ø–∏—Å–∞–Ω–∏–µ:**
TCP (Transmission Control Protocol) ‚Äî –ø—Ä–æ—Ç–æ–∫–æ–ª, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—â–∏–π –Ω–∞–¥–µ–∂–Ω—É—é, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –Ω–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –ø–µ—Ä–µ–¥–∞—á—É –¥–∞–Ω–Ω—ã—Ö –ø–æ —Å–µ—Ç–∏. –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã —Ä–∞–∑–±–µ—Ä–µ–º –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ö–∞–Ω–∏–∑–º—ã TCP: —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏ —Ä–∞–∑—Ä—ã–≤ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Ç–æ–∫–æ–º, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞, –∞ —Ç–∞–∫–∂–µ —Ä–µ–∞–ª–∏–∑—É–µ–º –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ TCP-—Å–µ–≥–º–µ–Ω—Ç–æ–≤ –≤ –û–°.

–û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ–º—ã:

* –¢—Ä–µ—Ö—ç—Ç–∞–ø–Ω–æ–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (3-way handshake)
* –§–æ—Ä–º–∞—Ç TCP-—Å–µ–≥–º–µ–Ω—Ç–∞ –∏ –ø–æ–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞
* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–∞–º–∏ –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –ø–æ—Ç–æ–∫–∞
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π –∏ –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–µ—Ä–µ–¥–∞—á–∞
* –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏ —Å–±—Ä–æ—Å

---

### –ü—Ä–∏–º–µ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ (network/tcp.c)

```c
#include <stdint.h>
#include <string.h>

typedef struct {
    uint16_t src_port;
    uint16_t dst_port;
    uint32_t seq_num;
    uint32_t ack_num;
    uint8_t  data_offset;
    uint8_t  flags;
    uint16_t window;
    uint16_t checksum;
    uint16_t urgent_ptr;
} __attribute__((packed)) tcp_header_t;

#define TCP_FLAG_SYN 0x02
#define TCP_FLAG_ACK 0x10
#define TCP_FLAG_FIN 0x01

void handle_tcp_packet(uint8_t* packet)
{
    tcp_header_t* tcp_hdr = (tcp_header_t*)packet;

    if(tcp_hdr->flags & TCP_FLAG_SYN) {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ SYN: –Ω–∞—á–∞–ª–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        send_syn_ack(tcp_hdr->src_port, tcp_hdr->dst_port, tcp_hdr->seq_num + 1);
    }
    else if(tcp_hdr->flags & TCP_FLAG_ACK) {
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
    }
    else if(tcp_hdr->flags & TCP_FLAG_FIN) {
        // –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
        send_ack(tcp_hdr->src_port, tcp_hdr->dst_port, tcp_hdr->seq_num + 1);
    }
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
}
```

---

### –ü–æ—è—Å–Ω–µ–Ω–∏—è:

* TCP –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ–ª–∞–≥–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (SYN, ACK, FIN).
* –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–¥–∞—á–∏.
* –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–∫–Ω–∞–º–∏ —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç –æ–±—ä–µ–º –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
* –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π ‚Äî –∫–ª—é—á–µ–≤–∞—è —á–∞—Å—Ç—å TCP-—Å—Ç–µ–∫–∞.

---

### –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ:

* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É SYN –∏ –æ—Ç–ø—Ä–∞–≤–∫—É SYN-ACK.
* –ù–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –æ–±—Ä–∞–±–æ—Ç–∫–∏ ACK.
* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å FIN.
* –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å TCP-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏.

---

### –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ –∏ –ø—Ä–∞–∫—Ç–∏–∫—É:

* –¢–µ–æ—Ä–∏—è: 6 —á–∞—Å–æ–≤
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 10 —á–∞—Å–æ–≤

---

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* RFC 793 ‚Äî TCP
* OSDev Wiki: TCP ([https://wiki.osdev.org/TCP](https://wiki.osdev.org/TCP))
* –ö–Ω–∏–≥–∏ –∏ —Å—Ç–∞—Ç—å–∏ –ø–æ —Å–µ—Ç–µ–≤–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é

---

### –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –û–±—ä—è—Å–Ω–µ–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∏ —Ä–∞–∑—Ä—ã–≤–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
* –ü–æ—à–∞–≥–æ–≤–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ TCP-—Å–µ–≥–º–µ–Ω—Ç–æ–≤
* –°–æ–≤–º–µ—Å—Ç–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞
* –û–±—Å—É–∂–¥–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–π TCP

---

–ì–æ—Ç–æ–≤ –∫ —É—Ä–æ–∫—É 17 ‚Äî UDP –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è? üì°
