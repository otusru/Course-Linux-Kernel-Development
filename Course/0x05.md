–û—Ç–ª–∏—á–Ω–æ, –¥–≤–∏–≥–∞–µ–º—Å—è –¥–∞–ª—å—à–µ! üöÄ

---

### üîπ –£—Ä–æ–∫ 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ —Ç–∞–π–º–µ—Ä–∞ PIT –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –µ–≥–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π

---

**–û–ø–∏—Å–∞–Ω–∏–µ:**
–°–∏—Å—Ç–µ–º–Ω—ã–π —Ç–∞–π–º–µ—Ä PIT (Programmable Interval Timer) ‚Äî –∫–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á –≤ –û–°. –û–Ω –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Å –∑–∞–¥–∞–Ω–Ω—ã–º –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º, –ø–æ–∑–≤–æ–ª—è—è —Å–∏—Å—Ç–µ–º–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å –∏ —Ç–∞–π–º-–∞—É—Ç—ã.

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã –Ω–∞—Å—Ç—Ä–æ–∏–º PIT –Ω–∞ –Ω—É–∂–Ω—É—é —á–∞—Å—Ç–æ—Ç—É, –ø–æ–¥–∫–ª—é—á–∏–º –µ–≥–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ PIC, —Ä–µ–∞–ª–∏–∑—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π —Ç–∞–π–º–µ—Ä–∞ –∏ –Ω–∞—É—á–∏–º—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏—Ö –¥–ª—è –æ—Ç—Å—á—ë—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∑–∞–¥–∞—á.

---

### –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (timer/pit.c)

```c
#include <stdint.h>

#define PIT_CHANNEL0 0x40
#define PIT_COMMAND  0x43
#define PIT_FREQ     1193182  // –ß–∞—Å—Ç–æ—Ç–∞ PIT –≤ –ì—Ü

static uint32_t tick_count = 0;

void pit_init(uint32_t frequency)
{
    uint32_t divisor = PIT_FREQ / frequency;

    // –ö–æ–º–∞–Ω–¥–∞: –∫–∞–Ω–∞–ª 0, —Ä–µ–∂–∏–º 2 (rate generator), –±–∏–Ω–∞—Ä–Ω—ã–π —Å—á–µ—Ç
    outb(PIT_COMMAND, 0x36);

    // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–µ–ª–∏—Ç–µ–ª—å –º–ª–∞–¥—à–∏–º –∏ —Å—Ç–∞—Ä—à–∏–º –±–∞–π—Ç–æ–º
    outb(PIT_CHANNEL0, divisor & 0xFF);
    outb(PIT_CHANNEL0, (divisor >> 8) & 0xFF);
}

void pit_handler()
{
    tick_count++;
    // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –∫–æ–¥ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∑–∞–¥–∞—á

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º EOI –≤ PIC
    pic_send_eoi(0);
}

uint32_t get_tick_count()
{
    return tick_count;
}
```

---

### –ü–æ—è—Å–Ω–µ–Ω–∏—è:

* PIT —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —á–∞—Å—Ç–æ—Ç–æ–π \~1.19 –ú–ì—Ü, –¥–µ–ª–∏—Ç–µ–ª—å —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∂–µ–ª–∞–µ–º—É—é —á–∞—Å—Ç–æ—Ç—É –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π.
* –†–µ–∂–∏–º 2 ‚Äî –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä —á–∞—Å—Ç–æ—Ç—ã, —É–¥–æ–±–µ–Ω –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π.
* –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á—ë—Ç—á–∏–∫ —Ç–∏–∫–æ–≤ –∏ —Å–∏–≥–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç PIC –æ–± –æ–∫–æ–Ω—á–∞–Ω–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏.
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –û–° –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–∞–π–º–∞—É—Ç–æ–≤ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∑–∞–¥–∞—á.

---

### –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–µ –∑–∞–¥–∞–Ω–∏–µ:

* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `pit_init` —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –≤—ã–±–æ—Ä–∞ —á–∞—Å—Ç–æ—Ç—ã.
* –ü–æ–¥–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π PIT –≤ IDT –∏ PIC.
* –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ QEMU, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—á—ë—Ç—á–∏–∫ —Ç–∏–∫–æ–≤, –≤—ã–≤–µ—Å—Ç–∏ –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –∫–æ–Ω—Å–æ–ª—å.
* –°–¥–µ–ª–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Ç–∞–π–º–µ—Ä–Ω—ã–π —Ü–∏–∫–ª, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–≤–æ–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É.

---

### –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ –∏ –ø—Ä–∞–∫—Ç–∏–∫—É:

* –¢–µ–æ—Ä–∏—è: 3 —á–∞—Å–∞
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 5 —á–∞—Å–æ–≤

---

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* OSDev Wiki: PIT ([https://wiki.osdev.org/Programmable\_Interval\_Timer](https://wiki.osdev.org/Programmable_Interval_Timer))
* Intel SDM (—Ä–∞–∑–¥–µ–ª—ã –ø–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º –∏ —Ç–∞–π–º–µ—Ä–∞–º)
* –ö–Ω–∏–≥–∏ –ø–æ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—é

---

### –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –ü–æ—è—Å–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã PIT –∏ –µ–≥–æ —Ä–æ–ª–∏ –≤ –û–°
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á–∞—Å—Ç–æ—Ç—ã –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
* –ü—Ä–∞–∫—Ç–∏–∫–∞ –Ω–∞ —ç–º—É–ª—è—Ç–æ—Ä–µ —Å –≤—ã–≤–æ–¥–æ–º –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
* –û–±—Å—É–∂–¥–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ –∏ —Ç–∞–π–º–µ—Ä–∞—Ö –û–°

---

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ —É—Ä–æ–∫—É 6 ‚Äî –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ —Ä–µ–∂–∏–º —è–¥—Ä–∞? üòâ
