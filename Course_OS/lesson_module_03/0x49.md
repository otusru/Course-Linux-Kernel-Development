–û—Ç–ª–∏—á–Ω–æ, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º! üöÄ

---

## üîπ –£—Ä–æ–∫ 50. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü ‚Äî –ø–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä –∏ –ø—Ä–∏–º–µ—Ä –∫–æ–¥–∞ üß©üíª

---

### üß† –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∞—è —á–∞—Å—Ç—å

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç **–∑–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü —Å—Ç—Ä–∞–Ω–∏—Ü** –≤ —Ä–µ–≥–∏—Å—Ç—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –∏ **–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü** –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏. –≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π —ç—Ç–∞–ø –≤ —Ä–∞–±–æ—Ç–µ —Å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç—å—é –∏ –∏–∑–æ–ª—è—Ü–∏–µ–π –ø—Ä–æ—Ü–µ—Å—Å–æ–≤.

#### –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–∞–±–ª–∏—Ü —Å—Ç—Ä–∞–Ω–∏—Ü

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∑–∞–ø–∏—Å–∞—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –≤ —Ä–µ–≥–∏—Å—Ç—Ä **CR3**. –≠—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä—É, –≥–¥–µ –∏—Å–∫–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞.

#### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü —Å—Ç—Ä–∞–Ω–∏—Ü

–ö–æ–≥–¥–∞ –û–° –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏, –æ–Ω–∞ –¥–æ–ª–∂–Ω–∞ –∏–∑–º–µ–Ω–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ CR3, —á—Ç–æ–±—ã –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å –∞–¥—Ä–µ—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ. –≠—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç, —á—Ç–æ –∫–∞–∂–¥—ã–π –ø—Ä–æ—Ü–µ—Å—Å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –ø–∞–º—è—Ç—å.

#### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

* –ê–¥—Ä–µ—Å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã—Ä–æ–≤–Ω–µ–Ω –ø–æ —Ä–∞–∑–º–µ—Ä—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
* –í —Ä–µ–∂–∏–º–µ —Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ –≤ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—è –¥–∞–Ω–Ω—ã–µ –∏–∑ CR3.
* –î–ª—è —Å–º–µ–Ω—ã –∞–¥—Ä–µ—Å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å CR3 –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å **TLB flush** (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –∞–¥—Ä–µ—Å–æ–≤).

---

### üõ† –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

```c
#include <stdint.h>

#define PAGE_SIZE 4096
#define NUM_PAGES 1024

typedef struct {
    uint32_t entries[NUM_PAGES];
} page_table_t;

typedef struct {
    page_table_t* tables[NUM_PAGES];
} page_directory_t;

page_directory_t* current_directory;

void load_page_directory(page_directory_t* dir) {
    current_directory = dir;
    asm volatile (
        "mov %0, %%cr3"
        :
        : "r"(dir)
    );
}

void enable_paging() {
    uint32_t cr0;
    asm volatile (
        "mov %%cr0, %0"
        : "=r"(cr0)
    );
    cr0 |= 0x80000000;  // –í–∫–ª—é—á–∞–µ–º –±–∏—Ç PG (Paging)
    asm volatile (
        "mov %0, %%cr0"
        :
        : "r"(cr0)
    );
}

void switch_page_directory(page_directory_t* dir) {
    load_page_directory(dir);
    // –û—á–∏—Å—Ç–∫–∞ TLB
    asm volatile ("invlpg (0)");
}
```

---

### üîç –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

* Intel Software Developer‚Äôs Manual ‚Äî —Ä–∞–∑–¥–µ–ª –æ CR3 –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø–∞–º—è—Ç—å—é
* [OSDev Wiki: Paging](https://wiki.osdev.org/Paging)
* –°—Ç–∞—Ç—å—è ‚ÄúUnderstanding x86 Paging‚Äù –Ω–∞ Medium

---

### ‚úÖ –ó–∞–¥–∞–Ω–∏–µ

1. –ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü –≤ CR3.
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –≤–∫–ª—é—á–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—á–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.
3. –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è–º–∏ —Å—Ç—Ä–∞–Ω–∏—Ü —Å –æ—á–∏—Å—Ç–∫–æ–π TLB.

---

–û—Ü–µ–Ω–∏–≤–∞–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å: 7/10
–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –≤—Ä–µ–º—è: 6 —á–∞—Å–æ–≤
–ú–µ—Ç–æ–¥–∏–∫–∞: –õ–µ–∫—Ü–∏—è + –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è + —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ–µ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ + –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–º–∞—à–Ω–µ–≥–æ –∑–∞–¥–∞–Ω–∏—è.

---

–ì–æ—Ç–æ–≤—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å? –ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏—Ç–µ **–¥–∞–¥–∞–¥–∞**!
