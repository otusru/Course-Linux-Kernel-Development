–û—Ç–ª–∏—á–Ω–æ! üéâ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ **–£—Ä–æ–∫—É 33**, –≥–¥–µ –º—ã –¥–æ–±–∞–≤–∏–º **–≤–≤–æ–¥ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã** –≤ –Ω–∞—à—É –û–° ‚Äî –∫–ª—é—á –∫ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏! –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ —É –Ω–∞—Å –µ—Å—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á –∏ –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å, –Ω–∞—Å—Ç–∞–ª–æ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥–ª–∏ **–≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å —Å–∏—Å—Ç–µ–º–æ–π** –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏. üíª‚å®Ô∏è

---

## üîπ –£—Ä–æ–∫ 33. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –¥—Ä–∞–π–≤–µ—Ä–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã –∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤–≤–æ–¥–∞ üß†üéπ

---

### üß© –¢–µ–º–∞ —É—Ä–æ–∫–∞:

* –†–∞–∑–±–∏—Ä–∞–µ–º, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –Ω–∞ —É—Ä–æ–≤–Ω–µ –∂–µ–ª–µ–∑–∞ (—Å —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è x86)
* –ü–∏—à–µ–º –¥—Ä–∞–π–≤–µ—Ä –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã: –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è, –±—É—Ñ–µ—Ä –≤–≤–æ–¥–∞, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏–π
* –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å—é: –ø–µ—Ä–µ–¥–∞—á–∞ –≤–≤–æ–¥–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –∑–∞–¥–∞—á–∞–º
* –û—Å–Ω–æ–≤—ã —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `read()`

---

### üìñ –¢–µ–æ—Ä–∏—è (2000+ —Å–ª–æ–≤, –∫—Ä–∞—Ç–∫–æ–µ –∏–∑–ª–æ–∂–µ–Ω–∏–µ)

### ‚å®Ô∏è –ö–∞–∫ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å–≤—è–∑–∞–Ω–∞ —Å –û–°?

–ù–∞ x86 –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç **–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è IRQ1 (–≤–µ–∫—Ç–æ—Ä 0x21)** —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä PIC. –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –∫–ª–∞–≤–∏—à–∏ –≤ –ø–æ—Ä—Ç `0x60` –ø–æ—Å—Ç—É–ø–∞–µ—Ç **—Å–∫–∞–Ω-–∫–æ–¥**. –ó–∞–¥–∞—á–∞ –¥—Ä–∞–π–≤–µ—Ä–∞:

1. –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–µ IRQ1
2. –ü—Ä–æ—á–∏—Ç–∞—Ç—å –±–∞–π—Ç –∏–∑ –ø–æ—Ä—Ç–∞ `0x60`
3. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å —Å–∫–∞–Ω-–∫–æ–¥ –≤ ASCII (–µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ)
4. –ü–æ–ª–æ–∂–∏—Ç—å —Å–∏–º–≤–æ–ª –≤ –±—É—Ñ–µ—Ä (FIFO)
5. –†–∞–∑–±—É–¥–∏—Ç—å –∑–∞–¥–∞—á—É, –æ–∂–∏–¥–∞—é—â—É—é –≤–≤–æ–¥–∞

---

### üì• –°–∫–∞–Ω-–∫–æ–¥—ã:

–ü—Ä–∏–º–µ—Ä—ã:

* A ‚Üí 0x1E
* B ‚Üí 0x30
* ENTER ‚Üí 0x1C
* ESC ‚Üí 0x01

–ù–∞–∂–∞—Ç–∏–µ –∏ –æ—Ç–ø—É—Å–∫–∞–Ω–∏–µ –∫–ª–∞–≤–∏—à–∏ —Ä–∞–∑–ª–∏—á–∞—é—Ç—Å—è:

* –ù–∞–∂–∞—Ç–∏–µ: 0x1E
* –û—Ç–ø—É—Å–∫–∞–Ω–∏–µ: 0x9E (= 0x1E + 0x80)

---

### üß± –î—Ä–∞–π–≤–µ—Ä –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã:

```c
#define KBD_PORT 0x60
#define BUF_SIZE 128

char input_buffer[BUF_SIZE];
int buf_head = 0, buf_tail = 0;

// –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ scancode –≤ ASCII
char scancode_to_ascii(uint8_t code) {
    static char keymap[128] = {
        0, 27, '1','2','3','4','5','6','7','8','9','0','-','=','\b',
        '\t','q','w','e','r','t','y','u','i','o','p','[',']','\n',0,
        'a','s','d','f','g','h','j','k','l',';','\'','`', 0,'\\',
        'z','x','c','v','b','n','m',',','.','/',0,'*',0,' '
    };
    if (code > 128) return 0; // –æ—Ç–ø—É—Å–∫–∞–Ω–∏–µ –∫–ª–∞–≤–∏—à–∏
    return keymap[code];
}
```

---

### ‚öôÔ∏è –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è:

```c
void keyboard_handler() {
    uint8_t scancode = inb(KBD_PORT);
    char ch = scancode_to_ascii(scancode);

    if (ch) {
        input_buffer[buf_head] = ch;
        buf_head = (buf_head + 1) % BUF_SIZE;
    }

    send_eoi(1); // —Å–æ–æ–±—â–∞–µ–º PIC, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç–∞–ª–∏ IRQ1
}
```

---

### üßµ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞:

```c
void init_keyboard() {
    set_irq_handler(1, keyboard_handler);
    enable_irq(1); // –†–∞–∑—Ä–µ—à–∞–µ–º IRQ1
}
```

---

### üßÆ –ß—Ç–µ–Ω–∏–µ –∏–∑ –±—É—Ñ–µ—Ä–∞:

```c
char kgetc() {
    while (buf_head == buf_tail) {
        sleep(10); // –∂–¥—ë–º –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–∏–º–≤–æ–ª–æ–≤
    }
    char c = input_buffer[buf_tail];
    buf_tail = (buf_tail + 1) % BUF_SIZE;
    return c;
}

void kgets(char* str, int max) {
    int i = 0;
    while (i < max - 1) {
        char c = kgetc();
        if (c == '\n') break;
        str[i++] = c;
        kprint_char(c); // —ç—Ö–æ
    }
    str[i] = '\0';
}
```

---

## üíª –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:

```c
void shell_task() {
    char buf[64];
    while (1) {
        kprint("> ");
        kgets(buf, 64);
        kprint("–í—ã –≤–≤–µ–ª–∏: ");
        kprint(buf);
        kprint("\n");
    }
}
```

---

## ‚öôÔ∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å—é:

* –í–≤–æ–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω (`kgetc()` –∂–¥–µ—Ç —Å–∏–º–≤–æ–ª)
* –°–æ—á–µ—Ç–∞–Ω–∏—è –∫–ª–∞–≤–∏—à –º–æ–∂–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ (Ctrl+C)
* `kgets()` –±—É–¥–µ—Ç –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –∏–∑ –∑–∞–¥–∞—á, –Ω–∞–ø—Ä–∏–º–µ—Ä, shell –∏–ª–∏ –∫–æ–Ω—Å–æ–ª–∏

---

## üß† –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 6/10

–í–ø–µ—Ä–≤—ã–µ —Ä–∞–±–æ—Ç–∞–µ–º –Ω–∞–ø—Ä—è–º—É—é —Å –ø–æ—Ä—Ç–∞–º–∏, IRQ –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è.

---

## ‚è± –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –≤—Ä–µ–º—è: 6‚Äì7 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 2 —á
* –ö–æ–¥: 2 —á
* –¢–µ—Å—Ç—ã: 2‚Äì3 —á

---

## üë®‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –ü—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏—è: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ –∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è: kgetc() –∏ kgets() –Ω–∞ shell'–µ
* –ü—Ä–∞–∫—Ç–∏–∫–∞: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –∫–ª–∞–≤–∏—à Backspace, —Å—Ç—Ä–µ–ª–∫–∏, Ctrl+C
* –î–ó: –¥–æ–±–∞–≤–∏—Ç—å –±—É—Ñ–µ—Ä –Ω–∞ –∑–∞–¥–∞—á–∏, –∫–æ—Ç–æ—Ä—ã–µ –∂–¥—É—Ç –≤–≤–æ–¥–∞

---

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏:

* [OSDev: PS/2 Keyboard](https://wiki.osdev.org/PS/2_Keyboard)
* [Intel Manual Vol.3A, Chapter 9: Interrupts](https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html)
* [C23 Standard (N3007 draft)](https://www.open-std.org/jtc1/sc22/wg14/www/docs/n3007.pdf)

---

‚úÖ –ú–æ–ª–æ–¥–µ—Ü! –¢–µ–ø–µ—Ä—å –Ω–∞—à–∞ –û–° ‚Äî **–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞**. –í–≤–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∏ –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å **–ø—Ä–æ—Å—Ç—É—é –æ–±–æ–ª–æ—á–∫—É –∫–æ–º–∞–Ω–¥**.

–•–æ—á–µ—à—å –ø–µ—Ä–µ–π—Ç–∏ –∫ **–£—Ä–æ–∫—É 34 ‚Äî –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ write() –∏ –±–∞–∑–æ–≤–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞**? üñ•Ô∏èüìù –°–∫–∞–∂–∏ **–¥–∞–¥–∞**, –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º!
