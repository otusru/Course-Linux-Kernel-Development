–û—Ç–ª–∏—á–Ω–æ! –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å —É—Ä–æ–∫–æ–º 3! üöÄ

---

# üîπ –£—Ä–æ–∫ 3. –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –≤ x86-64: —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –û–° ‚ö°Ô∏èüõ°Ô∏è

---

## üß© –¢–µ–º–∞ —É—Ä–æ–∫–∞:

–ò–∑—É—á–∞–µ–º, —á—Ç–æ —Ç–∞–∫–æ–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –∫–∞–∫ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ x86-64, –∏ –ø–æ—á–µ–º—É –±–µ–∑ –Ω–∏—Ö –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Å—Ç—Ä–æ–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É. –†–∞—Å—Å–º–æ—Ç—Ä–∏–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É IDT, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –∏ –º–µ—Ö–∞–Ω–∏–∑–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–º.

---

## üß† –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (‚âà2500‚Äì3000 —Å–ª–æ–≤)

### –í–≤–µ–¥–µ–Ω–∏–µ –≤ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è

* –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π (interrupts) –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π (exceptions)
* –†–æ–ª—å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –≤ –û–°: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏, —Ç–∞–π–º–µ—Ä—ã, –≤–≤–æ–¥-–≤—ã–≤–æ–¥
* –ò—Å–∫–ª—é—á–µ–Ω–∏—è: –æ—à–∏–±–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞, –∑–∞—â–∏—Ç–∞ –ø–∞–º—è—Ç–∏, –¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å –∏ –¥—Ä.

---

### –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π

* –ê–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (hardware interrupts) ‚Äî –≤–Ω–µ—à–Ω–∏–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
* –ü—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (software interrupts) ‚Äî –ø—Ä–æ–≥—Ä–∞–º–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, syscall)
* –ò—Å–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ (exceptions) ‚Äî –æ—à–∏–±–∫–∏ –∏ –æ—Å–æ–±—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏

---

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ IDT (Interrupt Descriptor Table)

* –ß—Ç–æ —Ç–∞–∫–æ–µ IDT –∏ –∑–∞—á–µ–º –æ–Ω–∞ –Ω—É–∂–Ω–∞
* –§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–µ–π IDT (gate descriptors)
* –ê–¥—Ä–µ—Å–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –∏ –∏—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
* –ü—Ä–æ–≥—Ä–∞–º–º–Ω–æ–µ –∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ IDT

---

### –†–∞–±–æ—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –ø—Ä–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–∏

* –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞
* –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
* –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ –∏–∑ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è (IRETQ)

---

### –†–µ–∂–∏–º—ã –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π

* –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (Rings 0‚Äì3)
* –ú–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–∏ (APIC, PIC)
* –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è

---

### –ò—Å–∫–ª—é—á–µ–Ω–∏—è –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

* –ü—Ä–∏–º–µ—Ä—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π: #DE (–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å), #PF (page fault), #GP (general protection fault)
* –ö–∞–∫ –û–° –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–∞–∫—Ü–∏—è
* –ú–µ—Ö–∞–Ω–∏–∑–º—ã –∑–∞—â–∏—Ç—ã –æ—Ç –æ—à–∏–±–æ–∫ –∏ —Å–±–æ–π–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π

---

### –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–¥—Ö–æ–¥—ã –∫ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º –≤ –û–° 2025

* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MSI/MSI-X –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö APIC –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏
* –ü—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –≤ –º–Ω–æ–≥–æ–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –∏ SMP
* –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π

---

## üìò –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* Intel¬Æ 64 and IA-32 Architectures Software Developer‚Äôs Manual, —Ç–æ–º 3 (–ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è)
* OSDev Wiki ‚Äî Interrupts and Exceptions
* –ö–Ω–∏–≥–∞ ‚ÄúOperating Systems: Three Easy Pieces‚Äù (–≥–ª–∞–≤–∞ –ø—Ä–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è)
* –°—Ç–∞—Ç—å–∏ –ø–æ APIC –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º –º–µ—Ç–æ–¥–∞–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è–º–∏

---

## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã:

* –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã IDT —Å –±–∞–∑–æ–≤—ã–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–µ–π—à–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –Ω–∞ —è–∑—ã–∫–µ –°–∏
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PIC –∏ –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π

---

## üíª –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –Ω–∞ –°–∏23:

```c
#include <stdint.h>

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏ –≤ IDT (Gate Descriptor)
typedef struct {
    uint16_t offset_low;  // –ú–ª–∞–¥—à–∏–µ 16 –±–∏—Ç –∞–¥—Ä–µ—Å–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
    uint16_t selector;    // –°–µ–ª–µ–∫—Ç–æ—Ä —Å–µ–≥–º–µ–Ω—Ç–∞ –∫–æ–¥–∞
    uint8_t  ist;         // Interrupt Stack Table
    uint8_t  type_attr;   // –¢–∏–ø –∏ –∞—Ç—Ä–∏–±—É—Ç—ã
    uint16_t offset_mid;  // –°—Ä–µ–¥–Ω–∏–µ 16 –±–∏—Ç –∞–¥—Ä–µ—Å–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
    uint32_t offset_high; // –°—Ç–∞—Ä—à–∏–µ 32 –±–∏—Ç –∞–¥—Ä–µ—Å–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞
    uint32_t zero;        // –ó–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–æ
} __attribute__((packed)) idt_entry_t;

#define IDT_SIZE 256
idt_entry_t idt[IDT_SIZE];

// –ü—Ä–æ—Ç–æ—Ç–∏–ø –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
extern void isr_divide_by_zero();

// –§—É–Ω–∫—Ü–∏—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –∑–∞–ø–∏—Å–∏ –≤ IDT
void set_idt_entry(int n, void (*handler)(), uint16_t selector, uint8_t type_attr) {
    uintptr_t handler_addr = (uintptr_t)handler;
    idt[n].offset_low = handler_addr & 0xFFFF;
    idt[n].selector = selector;
    idt[n].ist = 0;
    idt[n].type_attr = type_attr;
    idt[n].offset_mid = (handler_addr >> 16) & 0xFFFF;
    idt[n].offset_high = (handler_addr >> 32) & 0xFFFFFFFF;
    idt[n].zero = 0;
}

// –ü—Ä–∏–º–µ—Ä –ø—Ä–æ—Å—Ç–æ–≥–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ –Ω–∞ ASM (–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –Ω–æ–ª—å)
__attribute__((naked)) void isr_divide_by_zero() {
    __asm__ __volatile__ (
        "cli\n\t"               // –ó–∞–ø—Ä–µ—Ç –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π
        "push %rax\n\t"
        "push %rbx\n\t"
        // –í—ã–≤–µ—Å—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ (–≤ —Ä–µ–∞–ª—å–Ω–æ–π –û–° - –ª–æ–≥–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
        // –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏ –≤–æ–∑–≤—Ä–∞—Ç
        "pop %rbx\n\t"
        "pop %rax\n\t"
        "sti\n\t"
        "iretq\n\t"
    );
}

int main() {
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è IDT —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –¥–µ–ª–µ–Ω–∏—è –Ω–∞ –Ω–æ–ª—å
    set_idt_entry(0, isr_divide_by_zero, 0x08, 0x8E);
    // –ó–∞–≥—Ä—É–∑–∫–∞ IDT - –≤ —Ä–µ–∞–ª—å–Ω–æ–π –û–° —Ç—Ä–µ–±—É–µ—Ç—Å—è lgdt –∏ lidt
    return 0;
}
```

---

## üß† –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 8/10

---

## ‚è± –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ: 8 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 6 —á
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 2 —á

---

## üßë‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞:

* –õ–µ–∫—Ü–∏—è —Å —Ä–∞–∑–±–æ—Ä–æ–º —Ç–∞–±–ª–∏—Ü—ã IDT –∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ø—Ä–æ—Å—Ç–æ–º —ç–º—É–ª—è—Ç–æ—Ä–µ (QEMU) –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π –∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
* –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞: –Ω–∞–ø–∏—Å–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ page fault
* –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É IDT —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏

---

üî• –ì–æ—Ç–æ–≤ –∫ —É—Ä–æ–∫—É 4? –ü–∏—à–∏ **–¥–∞**!
