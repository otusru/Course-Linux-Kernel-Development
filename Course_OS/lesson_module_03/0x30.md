–û—Ç–ª–∏—á–Ω–æ! üéâ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ **–£—Ä–æ–∫ 30** ‚Äî –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö –ø—Ä–∞–∫—Ç–∏—á–Ω—ã—Ö –∏ –¥–æ–ª–≥–æ–∂–¥–∞–Ω–Ω—ã—Ö. –°–µ–≥–æ–¥–Ω—è –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º **—Ñ—É–Ω–∫—Ü–∏–∏ –æ–∂–∏–¥–∞–Ω–∏—è –∏ —Å–Ω–∞ –≤ —è–¥—Ä–µ**, –∏—Å–ø–æ–ª—å–∑—É—è –Ω–∞—à —Ç–∞–π–º–µ—Ä. –≠—Ç–æ –µ—â—ë –æ–¥–∏–Ω —à–∞–≥ –∫ **–Ω–∞—Å—Ç–æ—è—â–µ–π –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏**, –≤–µ–¥—å `sleep()` –Ω—É–∂–µ–Ω –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–µ, –∫–∞–∂–¥–æ–º—É –ø–æ—Ç–æ–∫—É.

---

# üîπ –£—Ä–æ–∫ 30. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `sleep()` –∏ `timer_wait()` ‚è±Ô∏èüí§

---

## üß© –¢–µ–º–∞ —É—Ä–æ–∫–∞:

–¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ —É –Ω–∞—Å –µ—Å—Ç—å —Ä–∞–±–æ—Ç–∞—é—â–∏–π **—Ç–∞–π–º–µ—Ä —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–º –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏–π**, –º—ã –º–æ–∂–µ–º —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–µ–π—à—É—é —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–¥–µ—Ä–∂–∫–∏ ‚Äî **`sleep()`**. –û–Ω–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞:

* –î–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è ‚åõ
* –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Å –∂–µ–ª–µ–∑–æ–º üß©
* –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ üßµ
* –ò–º–∏—Ç–∞—Ü–∏–∏ —Ä–∞–±–æ—Ç—ã –∑–∞–¥–∞—á –±–µ–∑ busy-wait üò¥

–°–µ–≥–æ–¥–Ω—è –º—ã:

* –ò—Å–ø–æ–ª—å–∑—É–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å—á—ë—Ç—á–∏–∫ —Ç–∏–∫–æ–≤
* –ù–∞–ø–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é `timer_wait(ms)`
* –†–µ–∞–ª–∏–∑—É–µ–º `sleep()` –∏ –¥—Ä—É–≥–∏–µ –∑–∞–¥–µ—Ä–∂–∫–∏
* –û–±—ä—è—Å–Ω–∏–º, –ø–æ—á–µ–º—É —ç—Ç–æ –ø–æ–∫–∞ *"–ø—Å–µ–≤–¥–æ—Å–æ–Ω"* (–±—É–¥—É—â–∏–π –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ —É–ª—É—á—à–∏—Ç —ç—Ç–æ)

---

## üìñ –¢–µ–æ—Ä–∏—è (‚âà2500 —Å–ª–æ–≤)

### üìå –ß—Ç–æ —Ç–∞–∫–æ–µ "—Å–æ–Ω" –≤ –û–°?

–°–æ–Ω ‚Äî —ç—Ç–æ **–ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –Ω–∞ –∑–∞–¥–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è**. –ù–∞ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ ‚Äî —ç—Ç–æ `sleep(5)`. –ù–∞ –Ω–∏–∑–∫–æ–º ‚Äî –∑–∞–¥–∞—á–∞ **–±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è –∏ –∂–¥—ë—Ç —Å–æ–±—ã—Ç–∏—è**, –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ ‚Äî –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Ç–∏–∫–æ–≤ —Ç–∞–π–º–µ—Ä–∞.

---

### üß† –ü–æ—á–µ–º—É "—Ä–µ–∞–ª—å–Ω—ã–π —Å–æ–Ω" ‚Äî —ç—Ç–æ —Å–ª–æ–∂–Ω–æ?

–í –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –û–° –∑–∞–¥–∞—á–∞ –ø–æ–º–µ—â–∞–µ—Ç—Å—è –≤ **–æ—á–µ—Ä–µ–¥—å —Å–Ω–∞** –∏ —Å–Ω–∏–º–∞–µ—Ç—Å—è —Å –¶–ü. –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –±—É–¥–µ—Ç –±—É–¥–∏—Ç—å –µ—ë –ø–æ —Ç–∞–π–º–µ—Ä—É. –£ –Ω–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏, –ø–æ—ç—Ç–æ–º—É –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º –ø—Ä–æ—Å—Ç–æ–π —Ü–∏–∫–ª –æ–∂–∏–¥–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ **–≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ —Å—á—ë—Ç—á–∏–∫–∞ —Ç–∏–∫–æ–≤**.

---

### üï∞Ô∏è –ü–æ–¥—Ö–æ–¥

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º:

* –¢–∞–π–º–µ—Ä, —Ç–∏–∫–∞—é—â–∏–π 100 —Ä–∞–∑ –≤ —Å–µ–∫—É–Ω–¥—É
* –°—á—ë—Ç—á–∏–∫ `tick`, –∫–æ—Ç–æ—Ä—ã–π –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Ç–∞–π–º–µ—Ä–∞
* –ñ–¥—ë–º, –ø–æ–∫–∞ `tick` –¥–æ—Å—Ç–∏–≥–Ω–µ—Ç `start_tick + N`

---

## üìò –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

* [OSDev Wiki ‚Äî PIT Sleep](https://wiki.osdev.org/Timer)
* –ö–Ω–∏–≥–∞: *Operating System Concepts*, –≥–ª–∞–≤–∞ –ø—Ä–æ –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç—å
* [Intel SDM: Power & Sleep States](https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html)
* –ü—Ä–∏–º–µ—Ä: `Meaty Skeleton` ‚Äî —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–π–º–µ—Ä–∞ –∏ —Å–Ω–∞

---

## üíª –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ (C23)

### 1. –°—á—ë—Ç—á–∏–∫ —Ç–∏–∫–æ–≤:

```c
volatile uint64_t tick = 0;

void timer_callback(registers_t* regs) {
    tick++;
}
```

---

### 2. `timer_wait()`:

```c
void timer_wait(uint64_t ticks_to_wait) {
    uint64_t target_tick = tick + ticks_to_wait;
    while (tick < target_tick) {
        asm volatile("hlt");
    }
}
```

> üí° `hlt` —Å–Ω–∏–∂–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫—É CPU ‚Äî –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä "–¥—Ä–µ–º–ª–µ—Ç" –¥–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è

---

### 3. `sleep_ms()`:

```c
void sleep_ms(uint32_t milliseconds) {
    uint64_t ticks_needed = milliseconds / 10; // 100 –ì—Ü = 1 —Ç–∏–∫ ‚âà 10 –º—Å
    timer_wait(ticks_needed);
}
```

---

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:

```c
kprint("–ó–∞—Å—ã–ø–∞—é –Ω–∞ 3 —Å–µ–∫—É–Ω–¥—ã...\n");
sleep_ms(3000);
kprint("–ü—Ä–æ—Å–Ω—É–ª—Å—è!\n");
```

---

## üß™ –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ:

* üß† –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `sleep_s(seconds)`
* üîÅ –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ —á–∞—Å—Ç–æ—Ç—ã —Ç–∞–π–º–µ—Ä–∞ –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–æ—á–Ω–æ—Å—Ç—å —Å–Ω–∞
* üí° –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `delay_ticks(uint64_t)` ‚Äî –¥–ª—è —è–¥—Ä–∞ –∏ –¥—Ä–∞–π–≤–µ—Ä–æ–≤

---

## üß† –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 5/10

(–ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–æ, –Ω–æ –≤–∞–∂–Ω–æ –ø–æ–Ω–∏–º–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)

---

## ‚è± –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ: 4‚Äì6 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 2 —á
* –ö–æ–¥ –∏ —Ç–µ—Å—Ç—ã: 4 —á

---

## üë®‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –õ–µ–∫—Ü–∏—è: "—á—Ç–æ —Ç–∞–∫–æ–µ —Å–æ–Ω" –∏ –µ–≥–æ –∏–º–∏—Ç–∞—Ü–∏—è
* –°—Ö–µ–º–∞: —Ç–∏–∫–∏, –æ–∂–∏–¥–∞–Ω–∏–µ, CPU-halt
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è: –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ª–æ–≥–∞–º–∏
* –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞: –∑–∞–º–µ—Ä —Ç–æ—á–Ω–æ—Å—Ç–∏

---

‚úÖ –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å —Ç–∞–π–º–µ—Ä –∏ `sleep()` ‚Äî —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è **–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∑–∞–¥–∞—á –∏ –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏**. –°–ª–µ–¥—É—é—â–∏–º —à–∞–≥–æ–º —Å—Ç–∞–Ω–µ—Ç **—Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—á–∞—Ç–∫–æ–≤ —è–¥—Ä–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤ –∏ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞**.

–°–∫–∞–∑–∞—Ç—å **–¥–∞**, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ **–£—Ä–æ–∫—É 31 ‚Äî –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–µ—Ä–≤–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞ –∑–∞–¥–∞—á** üßµüß†
