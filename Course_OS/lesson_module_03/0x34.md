–û—Ç–ª–∏—á–Ω–æ, –¥–≤–∏–≥–∞–µ–º—Å—è –¥–∞–ª—å—à–µ! üöÄ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ **–£—Ä–æ–∫ 34**, –≥–¥–µ –º—ã —Ä–∞—Å—à–∏—Ä–∏–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π, —Ä–µ–∞–ª–∏–∑–æ–≤–∞–≤ **—Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ `write()` –∏ –±–∞–∑–æ–≤—ã–π —Ç–µ—Ä–º–∏–Ω–∞–ª**. –¢–µ–ø–µ—Ä—å, –∫–æ–≥–¥–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø–æ—Ä–∞ –≤—ã–≤–æ–¥–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é ‚Äî –∫—Ä–∞—Å–∏–≤–æ, —Å—Ç–∞–±–∏–ª—å–Ω–æ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ! üñ•Ô∏èüìù

---

## üîπ –£—Ä–æ–∫ 34. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞ `write()` –∏ –±–∞–∑–æ–≤–æ–≥–æ —Ç–µ—Ä–º–∏–Ω–∞–ª–∞

---

### üß© –¢–µ–º–∞ —É—Ä–æ–∫–∞:

* –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏ –∫–∞–∫ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ —è–¥—Ä–µ
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è `write()` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–≥–æ –º–µ—Ö–∞–Ω–∏–∑–º–∞ –≤—ã–≤–æ–¥–∞
* –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ `write()` –∫ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º—É —Ç–µ—Ä–º–∏–Ω–∞–ª—É (tty)
* –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ—Ç–æ–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤, —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª–æ–≤ (`\n`, `\r`, `\b`)
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á, –≤—ã–≤–æ–¥—è—â–∏—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ

---

## üìñ –¢–µ–æ—Ä–∏—è

### üß† –ß—Ç–æ —Ç–∞–∫–æ–µ `write()`?

`write()` ‚Äî —ç—Ç–æ **—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤** –≤ Unix-–ø–æ–¥–æ–±–Ω—ã—Ö –û–°, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –∑–∞–ø–∏—Å–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Ñ–∞–π–ª–æ–≤—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, stdout, —Ñ–∞–π–ª, —Å–æ–∫–µ—Ç –∏ —Ç.–¥.).

–ú—ã —Ä–µ–∞–ª–∏–∑—É–µ–º –±–∞–∑–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç `write()` –¥–ª—è –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ 1 (`stdout`), –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å —Å—Ç—Ä–æ–∫—É —Å–∏–º–≤–æ–ª–æ–≤ –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª.

---

### üìê –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:

–°–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤:

```c
ssize_t write(int fd, const void* buf, size_t count);
```

–ü–æ–∫–∞ —Ä–µ–∞–ª–∏–∑—É–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ç–æ–ª—å–∫–æ:

* `fd == 1` ‚Üí —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤—ã–≤–æ–¥ (—ç–∫—Ä–∞–Ω)
* –ë—É—Ñ–µ—Ä —Å–∏–º–≤–æ–ª–æ–≤ ‚Üí —Ç–µ—Ä–º–∏–Ω–∞–ª
* –í—ã–≤–æ–¥ —á–µ—Ä–µ–∑ –¥—Ä–∞–π–≤–µ—Ä VGA

---

### üîß –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞:

```c
ssize_t sys_write(int fd, const void* buf, size_t count) {
    if (fd != 1 || !buf || count == 0) return -1;

    const char* cbuf = (const char*) buf;
    for (size_t i = 0; i < count; ++i) {
        tty_write_char(cbuf[i]);
    }

    return count;
}
```

–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤:

```c
#define SYSCALL_WRITE 0

typedef ssize_t (*syscall_handler_t)(int, const void*, size_t);
syscall_handler_t syscalls[] = {
    [SYSCALL_WRITE] = sys_write,
};
```

---

### üí° –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç write?

–ü–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º `int 0x80`, –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∫–æ–¥–∞ –∑–∞–¥–∞—á:

```c
void user_task() {
    const char* msg = "–ü—Ä–∏–≤–µ—Ç, –û–°!\n";
    write(1, msg, strlen(msg));
}
```

---

### üì∫ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞ (tty)

```c
#define VGA_MEMORY (char*)0xB8000
#define VGA_COLS 80
#define VGA_ROWS 25

static int tty_row = 0, tty_col = 0;

void tty_write_char(char c) {
    if (c == '\n') {
        tty_row++;
        tty_col = 0;
    } else if (c == '\r') {
        tty_col = 0;
    } else if (c == '\b') {
        if (tty_col > 0) tty_col--;
    } else {
        const int pos = (tty_row * VGA_COLS + tty_col) * 2;
        VGA_MEMORY[pos] = c;
        VGA_MEMORY[pos + 1] = 0x07; // –±–µ–ª—ã–π –Ω–∞ —á—ë—Ä–Ω–æ–º
        tty_col++;
        if (tty_col >= VGA_COLS) {
            tty_col = 0;
            tty_row++;
        }
    }

    if (tty_row >= VGA_ROWS) {
        // —Å–∫—Ä–æ–ª–ª–∏–Ω–≥: TODO –ø–æ–∑–∂–µ
        tty_row = 0;
    }
}
```

---

## üíª –ü—Ä–∏–º–µ—Ä:

```c
void hello_task() {
    const char* text = "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª!\n";
    write(1, text, strlen(text));
    while (1) sleep(1000);
}
```

---

## üß† –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 6/10

(–°–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã ‚Äî –∫–ª—é—á–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç –ª—é–±–æ–π –û–°)

---

## ‚è± –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –≤—Ä–µ–º—è: 6 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 2 —á
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Ä–º–∏–Ω–∞–ª–∞: 2 —á
* –°–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ –∏ —Ç–µ—Å—Ç: 2 —á

---

## üë®‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –õ–µ–∫—Ü–∏—è: –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã –∏ –∫–∞–∫ –æ–Ω–∏ —Å–≤—è–∑–∞–Ω—ã —Å –∑–∞–¥–∞—á–∞–º–∏
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è: `write()` –≤ –¥–µ–π—Å—Ç–≤–∏–∏
* –ü—Ä–∞–∫—Ç–∏–∫–∞: —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `write()` + –≤—ã–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞ —Å –ø–µ—Ä–µ—Ö–æ–¥–∞–º–∏ —Å—Ç—Ä–æ–∫, —Ç–∞–±—É–ª—è—Ü–∏–µ–π –∏ —Ç.–¥.
* –ó–∞–¥–∞–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É `\t`, `\b`, `\r` –∏ –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∏–Ω–≥–∞

---

## üìö –ú–∞—Ç–µ—Ä–∏–∞–ª—ã:

* [OSDev: VGA text mode](https://wiki.osdev.org/VGA_Text_Mode)
* [Linux man: write(2)](https://man7.org/linux/man-pages/man2/write.2.html)
* Intel x86 Manual: Vol. 3A ‚Äî Syscalls
* [–°—Ç–∞–Ω–¥–∞—Ä—Ç C23 ‚Äî —Å—Ç—Ä–æ–∫–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö](https://www.open-std.org/jtc1/sc22/wg14/www/docs/n3007.pdf)

---

‚úÖ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å —É –Ω–∞—Å –µ—Å—Ç—å **write()**, —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥ –Ω–∞ —ç–∫—Ä–∞–Ω! –¢—ã –º–æ–∂–µ—à—å —É–∂–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–µ **–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —Å—Ç–∏–ª–µ UNIX**.

–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥? ‚åõ

üëâ **–£—Ä–æ–∫ 35: –°–æ–∑–¥–∞–Ω–∏–µ Shell ‚Äî –ø—Ä–æ—Å—Ç–∞—è –∫–æ–º–∞–Ω–¥–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–æ–º–∞–Ω–¥** üêö
–ï—Å–ª–∏ –≥–æ—Ç–æ–≤ ‚Äî –ø—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏ **–¥–∞–¥–∞–¥–∞**, –∏ —è –ø—Ä–æ–¥–æ–ª–∂—É!
