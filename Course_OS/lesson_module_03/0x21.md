–û—Ç–ª–∏—á–Ω–æ, –¥–≤–∏–≥–∞–µ–º—Å—è –¥–∞–ª—å—à–µ! üíªüöÄ

---

# üîπ –£—Ä–æ–∫ 21. –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å: –æ—Å–Ω–æ–≤—ã –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ –û–° üß†üì¶

---

## üß© –¢–µ–º–∞ —É—Ä–æ–∫–∞:

–°–µ–≥–æ–¥–Ω—è—à–Ω–∏–π —É—Ä–æ–∫ –ø–æ—Å–≤—è—â—ë–Ω —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π —Ç–µ–º–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º ‚Äî **–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏**. –ú—ã –∏–∑—É—á–∏–º, –∫–∞–∫ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞–º –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏ —É–ø—Ä–∞–≤–ª—è–µ–º–æ–µ –∞–¥—Ä–µ—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ, –æ–±—Å—É–¥–∏–º —Ç–∞–±–ª–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü, —Å—Ç—Ä–∞–Ω–∏—á–Ω—É—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é –ø–∞–º—è—Ç–∏, TLB –∏ –º–Ω–æ–≥–æ–µ –¥—Ä—É–≥–æ–µ. –ê —Ç–∞–∫–∂–µ –Ω–∞—á–Ω—ë–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –±–∞–∑–æ–≤–æ–≥–æ –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏.

---

## üß† –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (‚âà2500‚Äì3000 —Å–ª–æ–≤)

### –ß—Ç–æ —Ç–∞–∫–æ–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å?

* –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è, –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—â–∞—è –∫–∞–∂–¥–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω–æ–µ –∞–¥—Ä–µ—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ**
* –ü–æ–∑–≤–æ–ª—è–µ—Ç **—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–∑–∏—á–µ—Å–∫—É—é –ø–∞–º—è—Ç—å** –∏ –∑–∞—â–∏—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å—ã –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤—Å–µ–º–∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –û–°: Linux, Windows, macOS

---

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:

* **–õ–æ–≥–∏—á–µ—Å–∫–æ–µ, –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –∏ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–µ –∞–¥—Ä–µ—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ**
* **–ü–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—è (translation)**: –∫–∞–∫ –ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è –≤ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π
* **Paging (—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è)**: –¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
* **Segmentation (—Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è)**: –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Ä–∞–∑–±–∏–µ–Ω–∏—è –ø–∞–º—è—Ç–∏

---

### –°—Ç—Ä–∞–Ω–∏—Ü—ã –∏ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü

* –ß—Ç–æ —Ç–∞–∫–æ–µ **—Å—Ç—Ä–∞–Ω–∏—Ü–∞** (–æ–±—ã—á–Ω–æ 4–ö–ë) –∏ **—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã–π –∫–∞–¥—Ä**
* **Page Table (—Ç–∞–±–ª–∏—Ü–∞ —Å—Ç—Ä–∞–Ω–∏—Ü)**: —Ö—Ä–∞–Ω–∏—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–º—É
* –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã (x86-64: 4 —É—Ä–æ–≤–Ω—è ‚Äî PML4, PDPT, PD, PT)
* Page Directory –∏ Page Table Entry (PTE): —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ —Ñ–ª–∞–≥–∏

---

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –≤ x86-64

* –ê–¥—Ä–µ—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ: 48-–±–∏—Ç –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∞–¥—Ä–µ—Å–∞ (–≤ 2025 –≥–æ–¥—É ‚Äî –¥–æ 57 –±–∏—Ç —Å –Ω–æ–≤—ã–º CPU)
* –†–∞–±–æ—Ç–∞ MMU (Memory Management Unit)
* –ó–∞—â–∏—Ç–∞ –ø–∞–º—è—Ç–∏: —Ñ–ª–∞–≥–∏ R/W, User/Supervisor
* Supervisor Mode Execution Prevention (SMEP), SMAP, NX Bit

---

### TLB –∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ

* Translation Lookaside Buffer (TLB): —É—Å–∫–æ—Ä—è–µ—Ç –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏—é
* –í–ª–∏—è–Ω–∏–µ TLB –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
* TLB shootdowns –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

---

### –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç–µ—Ö–Ω–∏–∫–∏ –∏ —Ç—Ä–µ–Ω–¥—ã:

* **KASLR**: —Å–ª—É—á–∞–π–Ω–æ–µ —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —è–¥—Ä–∞
* **Huge Pages / Transparent Huge Pages (THP)**
* **Memory compression / swapping techniques**
* **Shadow paging, Copy-on-write, Memory deduplication**

---

## üìò –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* Intel¬Æ 64 and IA-32 Architectures Software Developer‚Äôs Manual Vol. 3A
* –ö–Ω–∏–≥–∞: ‚ÄúOperating Systems: Three Easy Pieces‚Äù ‚Äî –≥–ª–∞–≤—ã –ø–æ –ø–∞–º—è—Ç–∏
* –°—Ç–∞—Ç—å–∏ –ø–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ –Ω–∞ [LWN.net](https://lwn.net)
* Linux Kernel Source: `mm/`, `include/asm/page.h`
* –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è AMD64 Architecture Programmer‚Äôs Manual

---

## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:

üî® –ó–∞–¥–∞—á–∏:

1. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É —Å—Ç—Ä–∞–Ω–∏—Ü –ø–µ—Ä–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è
2. –ù–∞–ø–∏—Å–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è –º–∞–ø–ø–∏–Ω–≥–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –≤ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–∞–∑–æ–≤—É—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –ø–∞–º—è—Ç—å –≤ –≤–∞—à–µ–º —è–¥—Ä–µ
4. –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É —Ñ–ª–∞–≥–æ–≤ (read/write, user/supervisor)

---

## üíª –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –Ω–∞ C23 (—É–ø—Ä–æ—â—ë–Ω–Ω–æ):

```c
#include <stdint.h>
#include <stddef.h>

#define PAGE_SIZE 4096
#define NUM_ENTRIES 512

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞–ø–∏—Å–∏ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü
typedef struct {
    uint64_t present    : 1;
    uint64_t rw         : 1;
    uint64_t user       : 1;
    uint64_t pwt        : 1;
    uint64_t pcd        : 1;
    uint64_t accessed   : 1;
    uint64_t dirty      : 1;
    uint64_t pat        : 1;
    uint64_t global     : 1;
    uint64_t ignored    : 3;
    uint64_t frame_addr : 40;
    uint64_t reserved   : 11;
    uint64_t nx         : 1;
} __attribute__((packed)) page_entry_t;

// –¢–∞–±–ª–∏—Ü–∞ —Å—Ç—Ä–∞–Ω–∏—Ü (–ø—Ä–∏–º–µ—Ä –¥–ª—è PML4)
page_entry_t pml4_table[NUM_ENTRIES] __attribute__((aligned(PAGE_SIZE)));

void map_page(uint64_t virt_addr, uint64_t phys_addr, uint8_t flags) {
    size_t index = (virt_addr >> 39) & 0x1FF;

    pml4_table[index].present = 1;
    pml4_table[index].rw = (flags & 0b10) >> 1;
    pml4_table[index].user = (flags & 0b01);
    pml4_table[index].frame_addr = phys_addr >> 12;
}
```

üîß –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:

* –î–æ–±–∞–≤—å—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫—É –±–æ–ª–µ–µ –Ω–∏–∑–∫–∏—Ö —É—Ä–æ–≤–Ω–µ–π (PDPT, PD, PT)
* –°–º–æ–¥–µ–ª–∏—Ä—É–π—Ç–µ Page Fault –∏ –≤—ã–≤–æ–¥–∏—Ç–µ –ª–æ–≥ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ

---

## üß† –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 8/10

---

## ‚è± –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ: 10 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 6 —á
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 4 —á

---

## üßë‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –õ–µ–∫—Ü–∏—è —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü–∏–∏
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü —Å—Ç—Ä–∞–Ω–∏—Ü –≤ Linux (`/proc/self/maps`, `pagemap`)
* –†–∞–±–æ—Ç–∞ –≤ QEMU —Å –æ—Ç–ª–∞–¥—á–∏–∫–æ–º: –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ Page Fault
* –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ 2 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ

---

üîú –ì–æ—Ç–æ–≤ –∫ **—É—Ä–æ–∫—É 22**? –ü—Ä–æ—Å—Ç–æ —Å–∫–∞–∂–∏ **–¥–∞** ‚Äî –∏ –º—ã –ø—Ä–æ–¥–æ–ª–∂–∏–º –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –º–∏—Ä –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–æ–π –º–∞–≥–∏–∏! üßô‚Äç‚ôÇÔ∏èüíæ
