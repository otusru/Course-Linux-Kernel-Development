–û—Ç–ª–∏—á–Ω–æ, –¥–≤–∏–≥–∞–µ–º—Å—è –¥–∞–ª—å—à–µ! üöÄ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ **–£—Ä–æ–∫ 41** ‚Äî —Å–µ–≥–æ–¥–Ω—è –º—ã –¥–æ–±–∞–≤–∏–º –ø–æ–¥–¥–µ—Ä–∂–∫—É **–≤–æ–∑–≤—Ä–∞—Ç–∞ –∫–æ–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è (`exit code`)** –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤ —è–¥—Ä–æ. –≠—Ç–æ –≤–∞–∂–Ω–∞—è —á–∞—Å—Ç—å –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –º–µ–∂–¥—É –ø—Ä–æ—Ü–µ—Å—Å–∞–º–∏ –∏ –æ—Å–Ω–æ–≤–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞, –æ–±–æ–ª–æ—á–∫–∏ –∏ —Å–∏—Å—Ç–µ–º–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏.

---

## üîπ –£—Ä–æ–∫ 41. –í–æ–∑–≤—Ä–∞—Ç –∫–æ–¥–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ (exit code) üßæ‚ò†Ô∏è

---

### üß© –¢–µ–º–∞ —É—Ä–æ–∫–∞:

* –ß—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ (exit code)?
* –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–æ–±—â–∞–µ—Ç —è–¥—Ä—É –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏
* –ö–∞–∫ —è–¥—Ä–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
* –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `exit()` –∏ —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ `exit`
* –ü—Ä–∞–∫—Ç–∏–∫–∞: —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `exit(int code)` –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ –∏ —è–¥—Ä–µ
* –ü—Ä–∏–º–µ—Ä –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞

---

## üìñ –¢–µ–æ—Ä–∏—è: –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ

### üìå –ß—Ç–æ —Ç–∞–∫–æ–µ –∫–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è?

–ö–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ (`exit code`) ‚Äî —ç—Ç–æ —Ü–µ–ª–æ–µ —á–∏—Å–ª–æ, —Å –∫–æ—Ç–æ—Ä—ã–º –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É. –û–±—ã—á–Ω–æ:

* `0` ‚Äî —É—Å–ø–µ—à–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
* `1+` ‚Äî –æ—à–∏–±–∫–∞ –∏–ª–∏ —Å–±–æ–π

–ü—Ä–æ–≥—Ä–∞–º–º—ã –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –∫–æ–¥ —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ `exit(int status)`, –ª–∏–±–æ –Ω–µ—è–≤–Ω–æ —á–µ—Ä–µ–∑ `return` –∏–∑ `main()`.

–í Unix-—Å–∏—Å—Ç–µ–º–∞—Ö —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –ø—Ä–æ—Ü–µ—Å—Å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å —ç—Ç–æ—Ç –∫–æ–¥ —á–µ—Ä–µ–∑ `wait()` –∏–ª–∏ `waitpid()` ‚Äî –≤ –±—É–¥—É—â–µ–º –º—ã —ç—Ç–æ —Ç–æ–∂–µ —Ä–µ–∞–ª–∏–∑—É–µ–º. –°–µ–π—á–∞—Å –≥–ª–∞–≤–Ω–æ–µ ‚Äî –ø–µ—Ä–µ–¥–∞—Ç—å –∫–æ–¥ –≤ —è–¥—Ä–æ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –≤ PCB (Process Control Block).

---

### üìå –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–∑—ã–≤–∞–µ—Ç `exit(int code)`
2. –Ø–¥—Ä–æ –ø–æ–ª—É—á–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤
3. –ó–∞–≤–µ—Ä—à–∞–µ—Ç –ø–æ—Ç–æ–∫/–ø—Ä–æ—Ü–µ—Å—Å, –æ—á–∏—â–∞–µ—Ç —Ä–µ—Å—É—Ä—Å—ã
4. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç `exit_code` –≤ PCB –∏–ª–∏ –ª–æ–≥

---

### üîß –°–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ `exit(int code)`

–°–æ–∑–¥–∞—ë–º –Ω–æ–º–µ—Ä —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä:

```c
#define SYS_exit 1
```

–í –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–µ:

```c
void exit(int code) {
    asm volatile (
        "movq $1, %%rax\n\t"     // SYS_exit
        "movq %0, %%rdi\n\t"     // –∞—Ä–≥—É–º–µ–Ω—Ç: –∫–æ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è
        "syscall\n\t"
        :
        : "r" ((long)code)
        : "%rax", "%rdi"
    );
    __builtin_unreachable();  // –Ω–µ –¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è
}
```

---

### üß† –Ø–¥—Ä–æ: –æ–±—Ä–∞–±–æ—Ç–∫–∞ `SYS_exit`

–í `syscall.c` –∏–ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤:

```c
void syscall_handler(uint64_t syscall_num, uint64_t arg1, ...) {
    switch (syscall_num) {
        case SYS_exit:
            process_exit((int)arg1);
            break;
        ...
    }
}
```

–í `process_exit()`:

```c
void process_exit(int status) {
    current_process->exit_code = status;
    current_process->state = PROCESS_ZOMBIE;

    // –û—á–∏—Å—Ç–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤
    release_memory(current_process);
    schedule_next();  // –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –¥—Ä—É–≥–æ–π –ø—Ä–æ—Ü–µ—Å—Å
}
```

---

### üß™ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞:

```c
#include <stdio.h>
#include <stdlib.h>

int main() {
    printf("–Ø –∑–∞–≤–µ—Ä—à–∞—é—Å—å —Å –∫–æ–¥–æ–º 42\n");
    exit(42);
}
```

---

### üîÑ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ —è–¥—Ä–µ

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —è–¥—Ä–æ –¥–æ–ª–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å `exit_code`. –ü–æ–∑–∂–µ –º—ã —Å–¥–µ–ª–∞–µ–º API, —á—Ç–æ–±—ã —Ä–æ–¥–∏—Ç–µ–ª—å –º–æ–≥ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –µ–≥–æ —Å –ø–æ–º–æ—â—å—é `wait()`.

---

### üìà –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 6/10

–ù—É–∂–Ω–æ —É–º–µ—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å–∏—Å—Ç–µ–º–Ω—ã–º–∏ –≤—ã–∑–æ–≤–∞–º–∏, —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –ø–∞–º—è—Ç—å—é.

---

### ‚è± –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ –≤—Ä–µ–º—è: 5 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 1.5 —á
* –ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏: 1 —á
* –ö–æ–¥ —è–¥—Ä–∞: 1.5 —á
* –û—Ç–ª–∞–¥–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ: 1 —á

---

### üë®‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –õ–µ–∫—Ü–∏—è: –∑–∞—á–µ–º –Ω—É–∂–µ–Ω –∫–æ–¥ –≤–æ–∑–≤—Ä–∞—Ç–∞ –∏ –∫–∞–∫ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è: `exit(42)` –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ –≤ –æ—Ç–ª–∞–¥—á–∏–∫–µ
* –°—Ö–µ–º–∞: –¥–∏–∞–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
* –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `exit`, —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ PCB
* –î–æ–º–∞—à–∫–∞: —Ä–∞—Å—à–∏—Ä–∏—Ç—å PCB –∏ –æ—Ç—Å–ª–µ–¥–∏—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ

---

### üìö –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* [man 2 exit](https://man7.org/linux/man-pages/man2/exit.2.html)
* [Linux kernel: do\_exit()](https://elixir.bootlin.com/linux/latest/source/kernel/exit.c)
* [OSDev ‚Äì Process Termination](https://wiki.osdev.org/Exit)

---

### üß† –ò—Ç–æ–≥–∏:

* –¢—ã —Ä–µ–∞–ª–∏–∑–æ–≤–∞–ª –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å –∫–æ–¥–æ–º
* –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã —Ç–µ–ø–µ—Ä—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ "—É—Ö–æ–¥—è—Ç"
* –û–° –º–æ–∂–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å, –ø–æ—á–µ–º—É –ø—Ä–æ–≥—Ä–∞–º–º–∞ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å

---

üîú –í **–£—Ä–æ–∫–µ 42** –º—ã –±—É–¥–µ–º —Ä–∞–∑—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é **—Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —è–¥—Ä–∞** –∏ –Ω–∞—É—á–∏–º —è–¥—Ä–æ –ø–µ—á–∞—Ç–∞—Ç—å —Å–æ–±—ã—Ç–∏—è –≤—Ä–æ–¥–µ `–ü—Ä–æ—Ü–µ—Å—Å #42 –∑–∞–≤–µ—Ä—à—ë–Ω —Å –∫–æ–¥–æ–º 1` –≤ –±—É—Ñ–µ—Ä –∏–ª–∏ –ª–æ–≥–æ–≤—ã–π –≤—ã–≤–æ–¥.

–°–∫–∞–∂–∏ **–¥–∞–¥–∞** ‚Äî –∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º! üß†üìíüí°
