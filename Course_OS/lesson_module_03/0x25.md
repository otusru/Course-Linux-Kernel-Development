–°—É–ø–µ—Ä! üõ†Ô∏è –ì–æ—Ç–æ–≤—å—Å—è ‚Äî —Å–µ–π—á–∞—Å –º—ã –ø–æ–≥—Ä—É–∂–∞–µ–º—Å—è –≤ –æ–¥–∏–Ω –∏–∑ —Å–∞–º—ã—Ö —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –º–æ–º–µ–Ω—Ç–æ–≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º: **–ø–µ—Ä–µ—Ö–æ–¥ –∏–∑ —Ä–µ–∂–∏–º–∞ —è–¥—Ä–∞ –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º (Ring 3)**. –≠—Ç–æ –æ—Å–Ω–æ–≤–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∏–∑–æ–ª—è—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤. –ü–æ–≥–Ω–∞–ª–∏! üöÄ

---

# üîπ –£—Ä–æ–∫ 25. –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º (Ring 3): –∑–∞—â–∏—Ç–∞ –∏ –∏–∑–æ–ª—è—Ü–∏—è üßë‚Äçüíªüõ°Ô∏è

---

## üß© –¢–µ–º–∞ —É—Ä–æ–∫–∞:

–û–° –¥–æ–ª–∂–Ω–∞ —É–º–µ—Ç—å –∑–∞–ø—É—Å–∫–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, **–∏–∑–æ–ª–∏—Ä—É—è –∏—Ö –æ—Ç —è–¥—Ä–∞**, —á—Ç–æ–±—ã –æ–Ω–∏ –Ω–µ –º–æ–≥–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –∂–µ–ª–µ–∑—É –∏–ª–∏ –ø–∞–º—è—Ç–∏ –û–°. –ò–º–µ–Ω–Ω–æ –¥–ª—è —ç—Ç–æ–≥–æ –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ x86-64 –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã **—Ä–µ–∂–∏–º—ã –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π**. –í —ç—Ç–æ–º —É—Ä–æ–∫–µ –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ—Ö–æ–¥–∞ –∏–∑ —è–¥—Ä–∞ –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Ä–µ–∂–∏–º –∏ –æ–±—Ä–∞—Ç–Ω–æ, –Ω–∞—É—á–∏–º—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å **—Å–µ–≥–º–µ–Ω—Ç–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã, —Ç–∞–±–ª–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü, —Å—Ç–µ–∫ –∏ —Å—Ç–µ–∫ –ø–µ—Ä–µ—Ö–æ–¥–∞**.

---

## üß† –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (‚âà2500‚Äì3000 —Å–ª–æ–≤)

### üß± –†–µ–∂–∏–º—ã –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π x86-64:

* Ring 0 (–Ø–¥—Ä–æ) ‚Äî –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—é
* Ring 3 (–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å) ‚Äî –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø, –≤—Å—ë —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã

---

### üîê –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?

* –ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
* –ó–∞—â–∏—Ç–∞ –ø–∞–º—è—Ç–∏ —è–¥—Ä–∞ –æ—Ç –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏–π
* –û–±–µ—Å–ø–µ—á–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (–º–æ–¥–µ–ª—å ¬´–º–∏–∫—Ä–æ—è–¥—Ä–∞¬ª –∏–ª–∏ –º–æ–Ω–æ–ª–∏—Ç–Ω–∞—è ‚Äî –Ω–µ –≤–∞–∂–Ω–æ)

---

### üßÆ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –≤ Ring 3:

1. **–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è —Å–µ–≥–º–µ–Ω—Ç—ã –∫–æ–¥–∞ –∏ –¥–∞–Ω–Ω—ã—Ö —Å CPL=3 (Current Privilege Level)**
2. **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —Å—Ç–µ–∫ Ring 0** –≤ TSS (Task State Segment) ‚Äî –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞ –æ–±—Ä–∞—Ç–Ω–æ
3. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `iretq`** (–∏–ª–∏ `sysret`/`syscall` –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞)
4. –ü–µ—Ä–µ–¥ `iretq` –Ω–∞ —Å—Ç–µ–∫ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è: `SS`, `RSP`, `RFLAGS`, `CS`, `RIP`

---

### üìê –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:

* –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è GDT —Å —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è Ring 0 –∏ Ring 3
* TSS —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —Å—Ç–µ–∫–∞ —è–¥—Ä–∞ (–ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)
* –¢–∞–±–ª–∏—Ü–∞ —Å—Ç—Ä–∞–Ω–∏—Ü, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –¥–æ—Å—Ç—É–ø –∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º—É –∫–æ–¥—É
* –§—Ä–µ–π–º –ø–µ—Ä–µ—Ö–æ–¥–∞ (RSP, RIP, —Å–µ–≥–º–µ–Ω—Ç—ã –∏ —Ñ–ª–∞–≥–∏)

---

### üîÅ –í–æ–∑–≤—Ä–∞—Ç –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞:

* –ü–æ —Å–∏—Å—Ç–µ–º–Ω–æ–º—É –≤—ã–∑–æ–≤—É (—á–µ—Ä–µ–∑ `int`, `syscall`)
* –û–±—Ä–∞—Ç–Ω–æ –≤ Ring 0
* –° –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å—Ç–µ–∫–∞ –∏–∑ TSS

---

### üåê –°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ç—Ä–µ–Ω–¥—ã (2025):

* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `syscall/sysret` –≤–º–µ—Å—Ç–æ `int 0x80` ‚Äî –±—ã—Å—Ç—Ä–µ–µ
* ASLR –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤
* SMEP/SMAP –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è ROP/JOP-–∞—Ç–∞–∫

---

## üìò –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* Intel¬Æ SDM Vol. 3A ‚Äî Chapters 6‚Äì7 (Privilege Levels, Protection)
* AMD64 Architecture Programmer‚Äôs Manual Vol. 2 ‚Äî SYSCALL and SYSRET
* Linux Source: `arch/x86/entry/entry_64.S`
* [osdev.org ‚Äî Transition to user mode](https://wiki.osdev.org/Entering_User_Mode)

---

## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:

üî® –ó–∞–¥–∞—á–∏:

1. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GDT —Å —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ Ring 3
2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å TSS —Å —É–∫–∞–∑–∞–Ω–∏–µ–º `rsp0`
3. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `enter_user_mode()`:

   * –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ç–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   * –ó–∞–≥—Ä—É–∑–∏—Ç—å —Å–µ–≥–º–µ–Ω—Ç—ã (SS, CS)
   * –í—ã–∑–≤–∞—Ç—å `iretq` —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–º `rip`
4. –í –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–º –∫–æ–¥–µ –≤—ã–≤–µ—Å—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ (—á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤)

---

## üíª –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –Ω–∞ C + –∞—Å—Å–µ–º–±–ª–µ—Ä (C23):

```c
// user_mode.c

#include <stdint.h>

extern void enter_user_mode(uint64_t rip, uint64_t rsp);

void user_program() {
    const char* msg = "üëã –ü—Ä–∏–≤–µ—Ç –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —Ä–µ–∂–∏–º–∞!\n";
    // –û–±—ã—á–Ω–æ —Ç—É—Ç –±—É–¥–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π –≤—ã–∑–æ–≤ –Ω–∞ –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å
    // –ú—ã –ø—Ä–æ—Å—Ç–æ –∑–∞–≤–∏—Å–∞–µ–º –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
    while (1);
}

void start_user_test() {
    uint64_t user_stack = 0x70000; // –∑–∞—Ä–∞–Ω–µ–µ –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Å—Ç–µ–∫
    enter_user_mode((uint64_t)user_program, user_stack);
}
```

```nasm
; user_mode.asm

global enter_user_mode
enter_user_mode:
    ; –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ —Å—Ç–µ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    mov ax, 0x23       ; USER_DS
    mov ds, ax
    mov es, ax
    mov fs, ax
    mov gs, ax

    pushq 0x23         ; SS (USER_DS)
    pushq rsi          ; RSP (–ø–µ—Ä–µ–¥–∞–Ω –≤ rsi)
    pushfq             ; RFLAGS
    pushq 0x1B         ; CS (USER_CS)
    pushq rdi          ; RIP (–ø–µ—Ä–µ–¥–∞–Ω –≤ rdi)
    iretq
```

> ‚ö†Ô∏è –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–µ–≥–º–µ–Ω—Ç—ã `0x1B` –∏ `0x23` –≤ GDT (Ring 3).

---

## üß† –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 9.5/10

(–º–Ω–æ–≥–æ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤, –≤–∞–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å –ø–æ—Ä—è–¥–æ–∫ —à–∞–≥–æ–≤)

---

## ‚è± –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ: 10 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 6 —á
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 4 —á

---

## üßë‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –°–ª–∞–π–¥–æ–≤–∞—è –ª–µ–∫—Ü–∏—è: —Å–µ–≥–º–µ–Ω—Ç–Ω–∞—è –º–æ–¥–µ–ª—å, —Å—Ç–µ–∫ –ø–µ—Ä–µ—Ö–æ–¥–∞
* –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ `iretq`
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –≤ QEMU: –ø–µ—Ä–µ—Ö–æ–¥ –∏ –≤–æ–∑–≤—Ä–∞—Ç
* –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: –Ω–∞–ø–∏—Å–∞—Ç—å –ø—Ä–æ—Å—Ç—É—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫—É—é —Ñ—É–Ω–∫—Ü–∏—é, –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –ø–æ `int 0x80`

---

üåÄ –í —Å–ª–µ–¥—É—é—â–µ–º —É—Ä–æ–∫–µ –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º **–ø–µ—Ä–≤—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã** –∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —è–¥—Ä–∞ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø—Ä–æ–≥—Ä–∞–º–º. –ì–æ—Ç–æ–≤? –ù–∞–ø–∏—à–∏ **–¥–∞–¥–∞**, —á—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –∫ **—É—Ä–æ–∫—É 26** ‚Äî —ç—Ç–æ –±—É–¥–µ—Ç üî•!
