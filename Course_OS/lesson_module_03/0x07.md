–û—Ç–ª–∏—á–Ω–æ! üöÄ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –Ω–∞ **–£—Ä–æ–∫ 7**, –≤ –∫–æ—Ç–æ—Ä–æ–º –º—ã —Å–¥–µ–ª–∞–µ–º –±–æ–ª—å—à–æ–π —à–∞–≥ –≤–ø–µ—Ä—ë–¥ ‚Äî –≤–ø–µ—Ä–≤—ã–µ –∑–∞–ø—É—Å—Ç–∏–º **—è–¥—Ä–æ –û–° –≤ Long Mode**, –Ω–∞—Å—Ç—Ä–æ–∏–º —Å—Ç–µ–∫, –∏ –ø–µ—Ä–µ–¥–∞–¥–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–∑ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞. –≠—Ç–æ –ø–æ–≤–æ—Ä–æ—Ç–Ω—ã–π –º–æ–º–µ–Ω—Ç: —Ç–µ–ø–µ—Ä—å —Ç—ã ‚Äî –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–µ–æ—Ä–µ—Ç–∏–∫, —Ç—ã –∑–∞–ø—É—Å–∫–∞–µ—à—å —Å–≤–æ—ë —è–¥—Ä–æ –Ω–∞ x86-64!

---

# üîπ –£—Ä–æ–∫ 7. –ó–∞–ø—É—Å–∫ —è–¥—Ä–∞ –≤ Long Mode –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞—á–∞–ª—å–Ω–æ–≥–æ —Å—Ç–µ–∫–∞ üßµ‚öôÔ∏è

---

## üß© –¢–µ–º–∞ —É—Ä–æ–∫–∞:

–¢—ã —É–∑–Ω–∞–µ—à—å, –∫–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç UEFI-–∑–∞–≥—Ä—É–∑—á–∏–∫–∞ –≤ —è–¥—Ä–æ, –∫–æ—Ç–æ—Ä–æ–µ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 64-–±–∏—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ. –†–∞–∑–±–µ—Ä—ë–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É —è–¥—Ä–∞ –Ω–∞ C –∏ ASM, –Ω–∞—Å—Ç—Ä–æ–π–∫—É —Å—Ç–µ–∫–∞, –ø–µ—Ä–µ–¥–∞—á—É –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –ø–∞–º—è—Ç–∏ –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—é —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞. –í–ø–µ—Ä–≤—ã–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è `main()` –≤ —Å—Ç–∏–ª–µ –û–°, –∞ –Ω–µ –ø—Ä–∏–∫–ª–∞–¥–Ω–æ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã.

---

## üß† –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (‚âà2500‚Äì3000 —Å–ª–æ–≤)

### –ì–¥–µ –º—ã —Å–µ–π—á–∞—Å?

* UEFI —É–∂–µ –∑–∞–≥—Ä—É–∑–∏–ª –±–∏–Ω–∞—Ä–Ω–∏–∫ —è–¥—Ä–∞ –≤ –ø–∞–º—è—Ç—å
* –¢–∞–±–ª–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü —Å–æ–∑–¥–∞–Ω—ã
* Long Mode –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω
* –ü–æ—Ä–∞ –ø–µ—Ä–µ–¥–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —è–¥—Ä—É –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

---

### –°—Ç–µ–∫ –≤ x86-64

* –°—Ç–µ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–≤–µ—Ä—Ö—É –≤–Ω–∏–∑ (–∞–¥—Ä–µ—Å–∞ —É–º–µ–Ω—å—à–∞—é—Ç—Å—è)
* –£–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞ ‚Äî `rsp`
* –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:

  * –ù–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å—Ç–µ–∫ ‚Üí –∫—Ä–∞—à
  * –°—Ç–µ–∫ –≤ ¬´–Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ–π¬ª –æ–±–ª–∞—Å—Ç–∏ –ø–∞–º—è—Ç–∏ ‚Üí Page Fault
* –•–æ—Ä–æ—à–∏–π —Ç–æ–Ω: –≤—ã–¥–µ–ª–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥ —Å—Ç–µ–∫ –∏ –∑–∞–¥–∞—Ç—å `rsp` –≤—Ä—É—á–Ω—É—é

---

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —è–¥—Ä–∞: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–û–±—ã—á–Ω–æ —è–¥—Ä–æ –≤–∫–ª—é—á–∞–µ—Ç:

```
kernel/
‚îú‚îÄ‚îÄ entry.asm       ; —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ kernel.c        ; main-—Ñ—É–Ω–∫—Ü–∏—è —è–¥—Ä–∞
‚îú‚îÄ‚îÄ linker.ld       ; –ª–∏–Ω–∫–æ–≤—â–∏–∫, —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ start
‚îî‚îÄ‚îÄ Makefile
```

---

### entry.asm ‚Äî –∑–∞–≥—Ä—É–∑–∫–∞ —è–¥—Ä–∞

```asm
section .text
global _start
extern kernel_main

_start:
    ; –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å—Ç–µ–∫–∞
    mov rsp, stack_top
    call kernel_main
    cli
.halt:
    hlt
    jmp .halt

section .bss
align 16
stack_bottom:
    resb 0x4000 ; 16 –ö–ë —Å—Ç–µ–∫
stack_top:
```

---

### kernel.c ‚Äî —è–¥—Ä–æ –Ω–∞ C23

```c
#include <stdint.h>

void kernel_main() {
    const char *msg = "–Ø–¥—Ä–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ Long Mode.\n";
    for (const char *p = msg; *p; ++p) {
        // –°–∏–º–≤–æ–ª—ã –Ω–∞ —ç–∫—Ä–∞–Ω —á–µ—Ä–µ–∑ –ø–æ—Ä—Ç 0xE9 (–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ QEMU)
        asm volatile ("outb %0, $0xE9" : : "a"(*p));
    }

    while (1) __asm__("hlt");
}
```

---

### –ü–æ—á–µ–º—É –∏—Å–ø–æ–ª—å–∑—É–µ–º `outb` –≤ –ø–æ—Ä—Ç 0xE9?

* QEMU –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—ã–≤–æ–¥ –Ω–∞ 0xE9 –∫–∞–∫ –æ—Ç–ª–∞–¥–æ—á–Ω—É—é —Å—Ç—Ä–æ–∫—É
* –û—Ç–ª–∏—á–Ω–æ –¥–ª—è –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ –±–µ–∑ –¥—Ä–∞–π–≤–µ—Ä–∞ VGA

---

### –£–∫–∞–∑–∞–Ω–∏–µ entry-point —á–µ—Ä–µ–∑ –ª–∏–Ω–∫–æ–≤—â–∏–∫

–§–∞–π–ª `linker.ld`:

```ld
ENTRY(_start)

SECTIONS
{
    . = 0x100000;

    .text : {
        *(.text)
    }

    .rodata : {
        *(.rodata*)
    }

    .data : {
        *(.data)
    }

    .bss : {
        *(.bss)
        *(COMMON)
    }
}
```

* `. = 0x100000;` ‚Äî –∞–¥—Ä–µ—Å –∑–∞–≥—Ä—É–∑–∫–∏ —è–¥—Ä–∞ –≤ –ø–∞–º—è—Ç—å (1 –ú–ë)
* `_start` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–∑ `entry.asm`

---

### –°–≤—è–∑—å —Å UEFI-–∑–∞–≥—Ä—É–∑—á–∏–∫–æ–º

* UEFI –∑–∞–≥—Ä—É–∂–∞–µ—Ç —è–¥—Ä–æ –∫–∞–∫ ELF/PE
* –ü–æ—Å–ª–µ `ExitBootServices()` ‚Üí –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ `_start`
* –í—Å—ë –æ—Å—Ç–∞–ª—å–Ω–æ–µ –¥–µ–ª–∞–µ—Ç —É–∂–µ –≤–∞—à–µ —è–¥—Ä–æ

---

## üìò –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* Intel¬Æ x86-64 Programmer's Manual Vol. 3: Call Stack and Control Transfer
* OSDev Wiki: Kernel Entry, Bootloaders
* [https://wiki.osdev.org/Bare\_Bones](https://wiki.osdev.org/Bare_Bones)
* x86 Calling Conventions: [https://wiki.osdev.org/System\_V\_ABI](https://wiki.osdev.org/System_V_ABI)
* Low-Level Programming ‚Äî Igor Zhirkov, –≥–ª–∞–≤—ã –ø–æ boot code

---

## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:

üî® –ó–∞–¥–∞—á–∏:

1. –ù–∞–ø–∏—Å–∞—Ç—å `entry.asm` —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–æ–π —Å—Ç–µ–∫–∞
2. –°–æ–∑–¥–∞—Ç—å `kernel.c` —Å —Ñ—É–Ω–∫—Ü–∏–µ–π `kernel_main()`
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `linker.ld`
4. –°–æ–±—Ä–∞—Ç—å —è–¥—Ä–æ —Å –ø–æ–º–æ—â—å—é `ld` –∏ `nasm`
5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ QEMU –∏ —É–≤–∏–¥–µ—Ç—å –≤—ã–≤–æ–¥ —Å—Ç—Ä–æ–∫–∏

---

## üíª Makefile (–ø—Ä–∏–º–µ—Ä):

```makefile
all: kernel.bin

kernel.o: kernel.c
	gcc -ffreestanding -m64 -c kernel.c -o kernel.o

entry.o: entry.asm
	nasm -f elf64 entry.asm -o entry.o

kernel.bin: entry.o kernel.o
	ld -n -T linker.ld -o kernel.bin entry.o kernel.o

clean:
	rm -f *.o *.bin
```

---

## üß† –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 7/10

---

## ‚è± –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ: 8 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 3‚Äì4 —á
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 4‚Äì5 —á

---

## üßë‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –õ–µ–∫—Ü–∏—è + –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –±–∞–∑–æ–≤–æ–≥–æ —è–¥—Ä–∞
* –†–∏—Å–æ–≤–∞–Ω–∏–µ call stack –∏ –ø—É—Ç–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
* –ü–æ—à–∞–≥–æ–≤–∞—è –∫–æ–º–ø–∏–ª—è—Ü–∏—è –∏ –∑–∞–ø—É—Å–∫ –≤ QEMU
* –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞: –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ, –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ª–∞–¥–∫—É
* –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: —Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–π –≤ `kernel.c`, –æ—Ç—Ä–∞–±–æ—Ç–∞—Ç—å –≤—ã–∑–æ–≤—ã

---

üéØ –ï—Å–ª–∏ –≥–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É ‚Äî **–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VGA/VESA –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –ø–µ—Ä–≤—ã–µ –ø–∏–∫—Å–µ–ª–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ** ‚Äî –ø–∏—à–∏ **–¥–∞–¥–∞–¥–∞**! üßë‚Äçüé®üñºÔ∏è
