–û—Ç–ª–∏—á–Ω–æ! –ü–æ–≥—Ä—É–∂–∞–µ–º—Å—è –¥–∞–ª—å—à–µ! üéØ

---

# üîπ –£—Ä–æ–∫ 4. –¢–∞–±–ª–∏—Ü–∞ GDT –∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ –≤ x86-64 üß±üì¶

---

## üß© –¢–µ–º–∞ —É—Ä–æ–∫–∞:

–°–µ–≥–æ–¥–Ω—è –º—ã –ø–æ–¥—Ä–æ–±–Ω–æ —Ä–∞–∑–±–µ—Ä–µ–º, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–∞ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–∞–º—è—Ç–∏ –≤ x86-64, –∏ –∫–∞–∫ —Å –Ω–µ–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–±–ª–∏—Ü–∞ GDT (Global Descriptor Table). –ú—ã –Ω–∞—É—á–∏–º—Å—è —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é GDT, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –∏ –ø–æ–π–º–µ–º, –ø–æ—á–µ–º—É —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å—É—Ç–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –≤ 64-–±–∏—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ ‚Äî –Ω–æ –≤—Å—ë –µ—â—ë –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–∞ –¥–ª—è –û–°.

---

## üß† –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (‚âà2500‚Äì3000 —Å–ª–æ–≤)

### –ß—Ç–æ —Ç–∞–∫–æ–µ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è?

* –ò—Å—Ç–æ—Ä–∏—è: –∑–∞—á–µ–º –æ–Ω–∞ –ø–æ—è–≤–∏–ª–∞—Å—å –≤ x86
* –°–µ–≥–º–µ–Ω—Ç—ã: Code, Data, Stack, Extra
* –°–µ–ª–µ–∫—Ç–æ—Ä—ã —Å–µ–≥–º–µ–Ω—Ç–æ–≤: —á—Ç–æ –æ–Ω–∏ —Ö—Ä–∞–Ω—è—Ç –∏ –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è
* –ü–æ–Ω—è—Ç–∏–µ ‚Äú—Å–µ–ª–µ–∫—Ç–æ—Ä‚Äù –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Å–µ–≥–º–µ–Ω—Ç–∞: –∏–Ω–¥–µ–∫—Å, TI (—Ç–∞–±–ª–∏—Ü–∞), RPL (—É—Ä–æ–≤–µ–Ω—å –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π)

---

### –ß—Ç–æ —Ç–∞–∫–æ–µ GDT?

* Global Descriptor Table ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –æ–ø–∏—Å–∞–Ω–∏–π —Å–µ–≥–º–µ–Ω—Ç–æ–≤
* –§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏ (segment descriptor): –±–∞–∑–æ–≤—ã–π –∞–¥—Ä–µ—Å, –ª–∏–º–∏—Ç, —Ñ–ª–∞–≥–∏
* –¢–∏–ø—ã –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–æ–≤: –∫–æ–¥, –¥–∞–Ω–Ω—ã–µ, TSS (Task State Segment)
* –†–∞–∑–º–µ—â–µ–Ω–∏–µ GDT –≤ –ø–∞–º—è—Ç–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ `lgdt`

---

### –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –≤ x86-64

* –í–∞–∂–Ω–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç 32-–±–∏—Ç: —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ—á—Ç–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∞
* –°–µ–≥–º–µ–Ω—Ç—ã CS, DS, SS, ES, FS, GS: –∫–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç –≤ long mode
* –°–µ–≥–º–µ–Ω—Ç—ã FS –∏ GS ‚Äî –∏—Å–∫–ª—é—á–µ–Ω–∏—è: –æ–Ω–∏ –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ FS/GS –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º —è–¥—Ä–∞/—Ç—Ä–µ–¥–∞

---

### –†–∞–±–æ—Ç–∞ —Å GDT

* –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ GDT, –µ—Å–ª–∏ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ?
* –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (ring 0/3) —á–µ—Ä–µ–∑ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä—ã
* –ö–∞–∫ –∑–∞–¥–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å–µ–ª–µ–∫—Ç–æ—Ä –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ
* –ó–∞–≥—Ä—É–∑–∫–∞ GDT –∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤

---

### –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ü–µ–Ω–Ω–æ—Å—Ç—å GDT –≤ –û–°

* –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –∏ –ø–µ—Ä–µ—Ö–æ–¥ –≤ long mode
* –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞
* –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TSS –∏ –µ–≥–æ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Å—Ç–µ–∫–∞ –ø—Ä–∏ –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è—Ö
* –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å –ø—Ä–æ—Ü–µ–¥—É—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏ —è–¥—Ä–∞

---

## üìò –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* Intel¬Æ Manual Vol. 3, –≥–ª–∞–≤—ã –ø–æ —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏ GDT
* OSDev Wiki: GDT Tutorial
* ‚ÄúSystem Programming Guide‚Äù –æ—Ç Intel
* –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –ø–æ –∞—Å—Å–µ–º–±–ª–µ—Ä—É NASM
* –°—Ç–∞—Ç—å–∏ –ø–æ low-level x86 –∏–∑ –±–ª–æ–≥–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º (Bran‚Äôs Kernel, Meaty Skeleton)

---

## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã:

* –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã GDT —Å —Å–µ–≥–º–µ–Ω—Ç–∞–º–∏ –∫–æ–¥–∞ –∏ –¥–∞–Ω–Ω—ã—Ö
* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ–≥–º–µ–Ω—Ç–æ–≤ —Å —Ä–∞–∑–Ω—ã–º–∏ —É—Ä–æ–≤–Ω—è–º–∏ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π
* –ó–∞–≥—Ä—É–∑–∫–∞ GDT —Å –ø–æ–º–æ—â—å—é `lgdt`
* –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–≥–º–µ–Ω—Ç–æ–≤, –∑–∞–≥—Ä—É–∑–∫–∞ TSS

---

## üíª –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ –Ω–∞ –°–∏23 (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ GDT):

```c
#include <stdint.h>

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ —Å–µ–≥–º–µ–Ω—Ç–∞
typedef struct {
    uint16_t limit_low;
    uint16_t base_low;
    uint8_t  base_mid;
    uint8_t  access;
    uint8_t  granularity;
    uint8_t  base_high;
} __attribute__((packed)) gdt_entry_t;

// –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —É–∫–∞–∑–∞—Ç–µ–ª—è GDT
typedef struct {
    uint16_t limit;
    uint64_t base;
} __attribute__((packed)) gdt_ptr_t;

gdt_entry_t gdt[3];
gdt_ptr_t gdt_ptr;

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä–∞ GDT
void set_gdt_entry(int i, uint32_t base, uint32_t limit, uint8_t access, uint8_t gran) {
    gdt[i].base_low    = base & 0xFFFF;
    gdt[i].base_mid    = (base >> 16) & 0xFF;
    gdt[i].base_high   = (base >> 24) & 0xFF;

    gdt[i].limit_low   = limit & 0xFFFF;
    gdt[i].granularity = (limit >> 16) & 0x0F;

    gdt[i].granularity |= gran & 0xF0;
    gdt[i].access      = access;
}

void gdt_install() {
    gdt_ptr.limit = sizeof(gdt) - 1;
    gdt_ptr.base  = (uint64_t)&gdt;

    set_gdt_entry(0, 0, 0, 0, 0);                // –ù—É–ª–µ–≤–æ–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä
    set_gdt_entry(1, 0, 0xFFFFFFFF, 0x9A, 0xA0); // –ö–æ–¥–æ–≤—ã–π —Å–µ–≥–º–µ–Ω—Ç
    set_gdt_entry(2, 0, 0xFFFFFFFF, 0x92, 0xA0); // –°–µ–≥–º–µ–Ω—Ç –¥–∞–Ω–Ω—ã—Ö

    asm volatile("lgdt %0" : : "m"(gdt_ptr));
    asm volatile(
        "mov $0x10, %ax\n\t"
        "mov %ax, %ds\n\t"
        "mov %ax, %es\n\t"
        "mov %ax, %fs\n\t"
        "mov %ax, %gs\n\t"
        "mov %ax, %ss\n\t"
        "jmp $0x08, $next_label\n\t"
        "next_label:\n\t"
    );
}
```

---

## üß† –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 7/10

---

## ‚è± –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ: 6 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 4 —á
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 2 —á

---

## üßë‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –õ–µ–∫—Ü–∏—è —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π —Ç–∞–±–ª–∏—Ü—ã GDT –∏ —Å–µ–ª–µ–∫—Ç–æ—Ä–æ–≤
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∏—è GDT –≤—Ä—É—á–Ω—É—é
* –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é GDT –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ—ë
* –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: –∏–∑–º–µ–Ω–∏—Ç—å –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏ —Å–µ–≥–º–µ–Ω—Ç–∞ –∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π —Å–µ–≥–º–µ–Ω—Ç

---

‚ú® –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî —ç—Ç–æ **–ø–µ—Ä–µ—Ö–æ–¥ –≤ long mode** –∏ UEFI-–∑–∞–≥—Ä—É–∑–∫–∞.
–ï—Å–ª–∏ –≥–æ—Ç–æ–≤ –∫ —É—Ä–æ–∫—É 5 ‚Äî –ø–∏—à–∏ **–¥–∞**!
