–û—Ç–ª–∏—á–Ω–æ! üöÄ –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–π –∫–ª—é—á–µ–≤–æ–π —Ç–µ–º–µ ‚Äî –Ω–∞—Å—Ç–æ—è—â–µ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ 64-–±–∏—Ç–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

---

# üîπ –£—Ä–æ–∫ 5. –ü–µ—Ä–µ—Ö–æ–¥ –≤ Long Mode –∏ –∑–∞–≥—Ä—É–∑–∫–∞ —è–¥—Ä–∞ —á–µ—Ä–µ–∑ UEFI üß¨üñ•Ô∏è

---

## üß© –¢–µ–º–∞ —É—Ä–æ–∫–∞:

–°–µ–≥–æ–¥–Ω—è –º—ã —Ä–∞–∑–±–µ—Ä—ë–º –ø—Ä–æ—Ü–µ—Å—Å –ø–µ—Ä–µ—Ö–æ–¥–∞ –∏–∑ 16-–±–∏—Ç–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ BIOS/UEFI –≤ 64-–±–∏—Ç–Ω—ã–π long mode, –≥–¥–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —è–¥—Ä–æ. –û–±—Å—É–¥–∏–º –≤–∞–∂–Ω–µ–π—à–∏–µ —ç—Ç–∞–ø—ã: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è GDT, –≤–∫–ª—é—á–µ–Ω–∏–µ PAE, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ CR0/CR4/EFER, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–≥—Ä—É–∑—á–∏–∫–∞ UEFI –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π x86-64.

---

## üß† –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (‚âà2500‚Äì3000 —Å–ª–æ–≤)

### –†–µ–∂–∏–º—ã –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞: –æ—Ç real mode –∫ long mode

* –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä x86 —Å—Ç–∞—Ä—Ç—É–µ—Ç –≤ **—Ä–µ–∞–ª—å–Ω–æ–º —Ä–µ–∂–∏–º–µ** (real mode) ‚Äî 16 –±–∏—Ç, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ 1 –ú–ë
* –î–∞–ª–µ–µ ‚Äî **–∑–∞—â–∏—â—ë–Ω–Ω—ã–π —Ä–µ–∂–∏–º** (protected mode, 32 –±–∏—Ç)
* –î–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ **long mode (64 –±–∏—Ç)** –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ:

  1. –í–∫–ª—é—á–∏—Ç—å PAE (Physical Address Extension)
  2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å GDT
  3. –°–æ–∑–¥–∞—Ç—å –Ω–∞—á–∞–ª—å–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Å—Ç—Ä–∞–Ω–∏—Ü
  4. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–ª–∞–≥ LME (Long Mode Enable) –≤ MSR EFER
  5. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ 64-–±–∏—Ç–Ω—ã–π —Å–µ–≥–º–µ–Ω—Ç –∫–æ–¥–∞
  6. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `jmp far`

---

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —á–µ—Ä–µ–∑ UEFI

* BIOS —É—Å—Ç–∞—Ä–µ–ª, –≤ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **UEFI (Unified Extensible Firmware Interface)**
* –Ø–¥—Ä–æ –û–° –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∫–∞–∫ **PE-–∑–∞–≥—Ä—É–∂–∞–µ–º—ã–π —Ñ–∞–π–ª**
* –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫ UEFI ‚Äî `bootx64.efi`, –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ C —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º EDK2
* –ó–∞–≥—Ä—É–∑—á–∏–∫ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –ø–∞–º—è—Ç–∏, –≤–∏–¥–µ–æ—Ä–µ–∂–∏–º–∞–º, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–∏—Å—Ç–µ–º–µ —á–µ—Ä–µ–∑ `EFI_SYSTEM_TABLE`

---

### –ö–ª—é—á–µ–≤—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã –∏ –∏—Ö –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

* CR0: —Ñ–ª–∞–≥ PE (bit 0) ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ –∑–∞—â–∏—â—ë–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞
* CR4: —Ñ–ª–∞–≥ PAE (bit 5) ‚Äî Physical Address Extension
* IA32\_EFER (MSR 0xC0000080): —Ñ–ª–∞–≥ LME (bit 8) ‚Äî –≤–∫–ª—é—á–µ–Ω–∏–µ long mode
* –ü–µ—Ä–µ—Ö–æ–¥ –≤ long mode –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º PAE –∏ EFER.LME

---

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ UEFI-–∑–∞–≥—Ä—É–∑—á–∏–∫–∞

* –ù–∞—á–∞–ª—å–Ω–∞—è —Ç–æ—á–∫–∞ ‚Äî `efi_main()`
* –í—ã–≤–æ–¥ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ `Print()`
* –ê–ª–ª–æ–∫–∞—Ü–∏—è –ø–∞–º—è—Ç–∏, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–∏–¥–µ–æ—Ä–µ–∂–∏–º–∞
* –ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–Ω–∞—Ä–Ω–æ–≥–æ —è–¥—Ä–∞ –≤ –ø–∞–º—è—Ç—å
* –ü–µ—Ä–µ–¥–∞—á–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ —è–¥—Ä–æ —á–µ—Ä–µ–∑ `ExitBootServices()`

---

### –ü–æ—á–µ–º—É UEFI ‚Äî —ç—Ç–æ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –∏ –≤–∞–∂–Ω–æ

* UEFI —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ 64-–±–∏—Ç–Ω–æ–º —Ä–µ–∂–∏–º–µ —Å—Ä–∞–∑—É
* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ ACPI, –∑–∞–≥—Ä—É–∑–∫–∞ –ø–æ —Å–µ—Ç–∏, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (Secure Boot)
* –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å GPT-—Ä–∞–∑–º–µ—Ç–∫–æ–π
* –î–æ—Å—Ç—É–ø –∫ –≤–∏–¥–µ–æ–±—É—Ñ–µ—Ä—É (GOP), USB, NVMe –∏ –¥—Ä.

---

## üìò –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* Intel¬Æ SDM, Vol. 3: –≥–ª–∞–≤–∞ –æ Long Mode –∏ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ö
* OSDev Wiki: Long Mode, Paging, UEFI Boot
* UEFI Specification v2.10 ([https://uefi.org/specifications](https://uefi.org/specifications))
* EDK II Project: [https://github.com/tianocore/edk2](https://github.com/tianocore/edk2)
* ‚ÄúModern x86 Assembly Language Programming‚Äù ‚Äî Daniel Kusswurm

---

## üí° –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã:

* –°–æ–∑–¥–∞–Ω–∏–µ UEFI-–∑–∞–≥—Ä—É–∑—á–∏–∫–∞ –Ω–∞ C
* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GDT –∏ —Ç–∞–±–ª–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü
* –í–∫–ª—é—á–µ–Ω–∏–µ PAE –∏ Long Mode
* –ü–µ—Ä–µ—Ö–æ–¥ –∏–∑ UEFI-–∑–∞–≥—Ä—É–∑—á–∏–∫–∞ –≤ —è–¥—Ä–æ –Ω–∞ C

---

## üíª –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞ UEFI-–∑–∞–≥—Ä—É–∑—á–∏–∫–∞ –Ω–∞ C (EDK II + gcc):

```c
#include <efi.h>
#include <efilib.h>

EFI_STATUS
efi_main(EFI_HANDLE ImageHandle, EFI_SYSTEM_TABLE *SystemTable) {
    InitializeLib(ImageHandle, SystemTable);
    Print(L"–ü—Ä–∏–≤–µ—Ç –∏–∑ UEFI –∑–∞–≥—Ä—É–∑—á–∏–∫–∞!\n");

    EFI_LOADED_IMAGE *loaded_image;
    uefi_call_wrapper(SystemTable->BootServices->HandleProtocol,
                      3, ImageHandle, &LoadedImageProtocol, (void**)&loaded_image);

    // –¢—É—Ç –º–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å –ø–∞–º—è—Ç—å, –Ω–∞–π—Ç–∏ —è–¥—Ä–æ, –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ, –∏ –ø–µ—Ä–µ–¥–∞—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

    return EFI_SUCCESS;
}
```

üõ† –ü–æ—è—Å–Ω–µ–Ω–∏–µ:

* `efi_main` ‚Äî —ç—Ç–æ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ UEFI-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
* –ß–µ—Ä–µ–∑ `Print()` –º–æ–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏ –æ—Ç–ª–∞–¥–æ—á–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
* –ß–µ—Ä–µ–∑ `SystemTable` –º—ã –ø–æ–ª—É—á–∞–µ–º –¥–æ—Å—Ç—É–ø –∫ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º, –ø–∞–º—è—Ç–∏ –∏ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–µ

---

## üß† –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 8/10

---

## ‚è± –í—Ä–µ–º—è –Ω–∞ –∏–∑—É—á–µ–Ω–∏–µ: 10 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 6 —á
* –ü—Ä–∞–∫—Ç–∏–∫–∞: 4 —á

---

## üßë‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* –õ–µ–∫—Ü–∏—è —Å –æ–±–∑–æ—Ä–æ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã UEFI –∏ long mode
* –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —è–¥—Ä–∞ —á–µ—Ä–µ–∑ UEFI –Ω–∞ QEMU
* –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞: –Ω–∞–ø–∏—Å–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–≥—Ä—É–∑—á–∏–∫
* –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ: —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–µ—Ä–µ—Ö–æ–¥ –≤ long mode

---

üéØ –ì–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –º–æ–¥—É–ª—é ‚Äî **—Ç–∞–±–ª–∏—Ü–∞–º —Å—Ç—Ä–∞–Ω–∏—Ü –∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏**?
–ï—Å–ª–∏ —Ç—ã –≥–æ—Ç–æ–≤ ‚Äî –Ω–∞–ø–∏—à–∏ **–¥–∞**!
