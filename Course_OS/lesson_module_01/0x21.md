–û—Ç–ª–∏—á–Ω–æ! üöÄ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ **–£—Ä–æ–∫ 21**, –≥–¥–µ –º—ã –∑–∞–ª–æ–∂–∏–º —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö ‚Äî –Ω–∞—á–Ω—ë–º –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é **—Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã**! üìÅüß† –≠—Ç–æ –∫–ª—é—á–µ–≤–æ–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –û–°: –±–µ–∑ –Ω–µ—ë –ø—Ä–æ–≥—Ä–∞–º–º—ã –Ω–µ –º–æ–≥—É—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –∏–ª–∏ —á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª—ã, —è–¥—Ä–æ –Ω–µ –º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –º–æ–¥—É–ª–∏, –∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Äî —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏.

---

# üîπ –£—Ä–æ–∫ 21. –§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞: –≤–≤–µ–¥–µ–Ω–∏–µ –∏ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Å–ª–æ–π VFS üìÇüîß

---

## üß© –¢–µ–º–∞ —É—Ä–æ–∫–∞:

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ —Ç—ã:

* –£–∑–Ω–∞–µ—à—å, –∫–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω—ã —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã (ext2, FAT32, tmpfs –∏ –¥—Ä.)
* –†–∞–∑–±–µ—Ä—ë—à—å –ø–æ–Ω—è—Ç–∏–µ VFS (Virtual File System) ‚Äî –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π —Å–ª–æ–π –Ω–∞–¥ –≤—Å–µ–º–∏ –§–°
* –†–µ–∞–ª–∏–∑—É–µ—à—å –±–∞–∑–æ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã: `inode`, `dentry`, `file`, `superblock`
* –°–æ–∑–¥–∞—à—å –∫–∞—Ä–∫–∞—Å VFS, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—â–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã
* –ü–æ–¥–∫–ª—é—á–∏—à—å –ø—Å–µ–≤–¥–æ-—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ `/dev/null` –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏

---

## üß† –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (‚âà2500‚Äì3000 —Å–ª–æ–≤)

### üìÇ –ß—Ç–æ —Ç–∞–∫–æ–µ —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞?

–§–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ ‚Äî —ç—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –¥–∏—Å–∫–µ –∏–ª–∏ –≤ –ø–∞–º—è—Ç–∏, –∫–æ—Ç–æ—Ä–∞—è –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏–µ, –¥–æ—Å—Ç—É–ø –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞–º–∏ –∏ –∫–∞—Ç–∞–ª–æ–≥–∞–º–∏.

---

### üß© –û—Å–Ω–æ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏ –§–°:

* üéØ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ (—Ñ–∞–π–ª—ã, –∫–∞—Ç–∞–ª–æ–≥–∏)
* üß≠ –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –ø—É—Ç—è–º (`/usr/bin/ls`)
* üîê –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ (UID, –ø—Ä–∞–≤–∞)
* ‚è± –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ (–≤—Ä–µ–º—è —Å–æ–∑–¥–∞–Ω–∏—è, –∏–∑–º–µ–Ω–µ–Ω–∏—è)
* üìÑ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞–º–∏ –∏ –∏–Ω–¥–µ–∫—Å–∞–º–∏

---

### üß† –ß—Ç–æ —Ç–∞–∫–æ–µ VFS?

VFS ‚Äî —ç—Ç–æ **–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å**, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–π —è–¥—Ä–æ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å —Ä–∞–∑–Ω—ã–º–∏ –§–° –∫–∞–∫ —Å –µ–¥–∏–Ω—ã–º API. –ü—Ä–∏–º–µ—Ä—ã:

* `/dev/sda1` ‚Üí ext2
* `/dev/sda2` ‚Üí FAT32
* `tmpfs` ‚Üí –ø–∞–º—è—Ç—å

–Ø–¥—Ä–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç –Ω–µ –Ω–∞–ø—Ä—è–º—É—é —Å –∫–∞–∂–¥–æ–π –§–°, –∞ —á–µ—Ä–µ–∑ VFS, –∫–æ—Ç–æ—Ä—ã–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –≤—ã–∑–æ–≤—ã.

---

### üß± –ö–ª—é—á–µ–≤—ã–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã VFS:

| –°—Ç—Ä—É–∫—Ç—É—Ä–∞    | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                   |
| ------------ | -------------------------------------------- |
| `inode`      | –û–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª: —Ä–∞–∑–º–µ—Ä, –ø—Ä–∞–≤–∞, –∏–Ω–¥–µ–∫—Å—ã       |
| `dentry`     | –≠–ª–µ–º–µ–Ω—Ç –ø—É—Ç–∏ (–∫–∞—Ç–∞–ª–æ–≥, –∏–º—è —Ñ–∞–π–ª–∞)            |
| `file`       | –û—Ç–∫—Ä—ã—Ç—ã–π –¥–µ—Å–∫—Ä–∏–ø—Ç–æ—Ä —Ñ–∞–π–ª–∞                    |
| `superblock` | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã                  |
| `vfs_ops`    | –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –æ–ø–µ—Ä–∞—Ü–∏–π –§–° (open, read, write...) |

---

### üîå –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –§–°:

–ö–∞–∂–¥–∞—è –§–° —Ä–µ–∞–ª–∏–∑—É–µ—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É `file_system_type` –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `vfs_register()`, —á—Ç–æ–±—ã —è–¥—Ä–æ –∑–Ω–∞–ª–æ, –∫–∞–∫ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–∞–±–æ—Ç–∞—Ç—å —Å –Ω–µ–π.

---

### üîÑ –ü–æ—Ç–æ–∫ –≤—ã–∑–æ–≤–∞:

```text
open("/dev/null")
  ‚Üì
vfs_open(path)
  ‚Üì
resolve path ‚Üí dentry
  ‚Üì
dentry ‚Üí inode ‚Üí ops.open()
```

---

### üé≠ –ü—Ä–∏–º–µ—Ä: `/dev/null`

–≠—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ, –≤ –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å (–æ–Ω–æ ¬´–≥–ª–æ—Ç–∞–µ—Ç¬ª –≤—Å—ë) –∏ –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ–ª—å–∑—è —á–∏—Ç–∞—Ç—å (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç EOF). –û—Ç–ª–∏—á–Ω—ã–π —Å–ø–æ—Å–æ–± –æ—Ç–ª–∞–¥–∫–∏.

---

## üìò –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* [Linux VFS internals (LWN)](https://lwn.net/Kernel/LDD3/)
* [OSDev Wiki: File Systems](https://wiki.osdev.org/File_Systems)
* [Ext2 spec](https://www.nongnu.org/ext2-doc/ext2.html)
* [UNIX VFS Interface](https://en.wikipedia.org/wiki/Virtual_file_system)

---

## üí° –¶–µ–ª—å –ø—Ä–∞–∫—Ç–∏–∫–∏:

* –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É `vfs_node_t`, `inode_t`, `file_t`
* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å VFS-API: `vfs_open()`, `vfs_read()`, `vfs_write()`
* –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å `nullfs` —Å `/dev/null`
* –°–¥–µ–ª–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ω–µ–º—É –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –Ω–∞ C23

### `vfs.h`

```c
#pragma once

typedef struct vfs_node {
    char name[64];
    struct inode* inode;
    struct vfs_node* parent;
    struct vfs_node* children[16];
} vfs_node_t;

typedef struct inode {
    size_t size;
    int (*read)(struct inode*, char*, size_t);
    int (*write)(struct inode*, const char*, size_t);
} inode_t;

vfs_node_t* vfs_open(const char* path);
int vfs_write(vfs_node_t* node, const char* data, size_t len);
```

---

### `nullfs.c`

```c
#include "vfs.h"
#include <string.h>
#include <stdio.h>

static int null_read(inode_t* node, char* buf, size_t len) {
    return 0; // EOF
}

static int null_write(inode_t* node, const char* buf, size_t len) {
    return len; // –ø—Ä–∏—Ç–≤–æ—Ä–∏–º—Å—è, —á—Ç–æ –∑–∞–ø–∏—Å–∞–ª–∏
}

void init_nullfs() {
    static inode_t null_inode = {
        .size = 0,
        .read = null_read,
        .write = null_write,
    };

    static vfs_node_t dev_null = {
        .name = "null",
        .inode = &null_inode,
        .parent = NULL
    };

    vfs_register("/dev/null", &dev_null);
}
```

---

### `user_main()`

```c
void user_main() {
    vfs_node_t* node = vfs_open("/dev/null");
    const char* msg = "Hello, null!\n";
    vfs_write(node, msg, strlen(msg));
}
```

---

## üß† –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 7/10

---

## ‚è± –í—Ä–µ–º—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: 8 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 2.5 —á
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è VFS: 3 —á
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è nullfs: 2 —á
* –î–æ–º–∞—à–∫–∞: 0.5 —á

---

## üßë‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* üìö –õ–µ–∫—Ü–∏—è: —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ VFS, inode, superblock
* üí° –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è: `/dev/null` –≤ Linux –∏ —É –Ω–∞—Å
* üíª –ü—Ä–∞–∫—Ç–∏–∫–∞: —Å–æ–∑–¥–∞—Ç—å nullfs, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
* üìù –î–æ–º–∞—à–∫–∞:

  * –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `dev/zero` (–≤—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `\0`)
  * –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `dev/random` (—Ä–∞–Ω–¥–æ–º–Ω—ã–π –±–∞–π—Ç)
  * –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `write()` –≤ user-–ø—Ä–æ–≥—Ä–∞–º–º–µ

---

üéâ –ì–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —à–∞–≥—É? –í **–£—Ä–æ–∫–µ 22** –º—ã —Å–æ–∑–¥–∞–¥–∏–º **RAM-–¥–∏—Å–∫–æ–≤—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É (tmpfs)** ‚Äî –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—é—â—É—é –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏.
–ü–∏—à–∏ **–¥–∞**, –∏ –ø—Ä–æ–¥–æ–ª–∂–∏–º!
