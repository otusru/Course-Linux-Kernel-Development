–û—Ç–ª–∏—á–Ω–æ! üß† –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ **–£—Ä–æ–∫ 22** ‚Äî –∑–¥–µ—Å—å –º—ã —Ä–∞—Å—à–∏—Ä–∏–º –Ω–∞—à VFS –∏ —Å–æ–∑–¥–∞–¥–∏–º –ø–µ—Ä–≤—É—é **—Ä–µ–∞–ª—å–Ω—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É –≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏ ‚Äî tmpfs**. üìÇüß™ –û–Ω–∞ –ª–µ–≥–∫–∞—è, –±—ã—Å—Ç—Ä–∞—è –∏ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤, –∫—ç—à–∞ –∏ —Ç–µ—Å—Ç–æ–≤.

---

# üîπ –£—Ä–æ–∫ 22. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã tmpfs (–≤ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏) üß†üìÅ

---

## üß© –¢–µ–º–∞ —É—Ä–æ–∫–∞:

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ —Ç—ã:

* –ò–∑—É—á–∏—à—å –∫–æ–Ω—Ü–µ–ø—Ü–∏—é in-memory FS (tmpfs) –∏ –∏—Ö –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
* –†–∞—Å—à–∏—Ä–∏—à—å –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ `inode`, `file`, `vfs_node`
* –†–µ–∞–ª–∏–∑—É–µ—à—å –ø—Ä–æ—Å—Ç—É—é –¥—Ä–µ–≤–æ–≤–∏–¥–Ω—É—é —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É —Å —Ñ–∞–π–ª–∞–º–∏ –∏ –ø–∞–ø–∫–∞–º–∏
* –î–æ–±–∞–≤–∏—à—å –∫–æ–º–∞–Ω–¥—ã: `mkdir`, `create`, `read`, `write`
* –°–¥–µ–ª–∞–µ—à—å —á—Ç–µ–Ω–∏–µ –∏ –∑–∞–ø–∏—Å—å –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞

---

## üß† –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (‚âà2500‚Äì3000 —Å–ª–æ–≤)

### üìÅ –ß—Ç–æ —Ç–∞–∫–æ–µ tmpfs?

**tmpfs** (Temporary Filesystem) ‚Äî —ç—Ç–æ —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ **–æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–π –ø–∞–º—è—Ç–∏** (RAM). –û–Ω–∞ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –≤—ã–∫–ª—é—á–µ–Ω–∏—è, –Ω–æ –∑–∞—Ç–æ **–º–≥–Ω–æ–≤–µ–Ω–Ω–æ** —Ä–∞–±–æ—Ç–∞–µ—Ç –∏ –∏–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:

* –í—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ `/tmp`
* RAM-–¥–∏—Å–∫–æ–≤
* –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

---

### üí° –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?

* –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç—ã —Å –¥–µ—Ä–µ–≤–æ–º –∫–∞—Ç–∞–ª–æ–≥–æ–≤
* –ü–æ–Ω–∏–º–∞–Ω–∏–µ –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ `create`, `lookup`, `open`, `read`, `write`
* –û—Å–Ω–æ–≤—ã –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (inode), —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–∞
* –ù–∞—á–∞–ª–æ –ø—É—Ç–∏ –∫ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º –¥–∏—Å–∫–æ–≤—ã–º –§–° (ext2, FAT32)

---

### üß† –°—Ç—Ä—É–∫—Ç—É—Ä–∞ tmpfs:

```text
root
‚îú‚îÄ‚îÄ hello.txt
‚îî‚îÄ‚îÄ folder/
    ‚îî‚îÄ‚îÄ data.bin
```

* –ö–∞–∂–¥—ã–π —Ñ–∞–π–ª –∏ –∫–∞—Ç–∞–ª–æ–≥ ‚Äî `inode` —Å —Ç–∏–ø–æ–º
* –í –ø–∞–ø–∫–µ ‚Äî —Å–ø–∏—Å–æ–∫ `dentry` (–∏–º—è + inode)
* `read`, `write` —Ä–∞–±–æ—Ç–∞—é—Ç —Å –±—É—Ñ–µ—Ä–æ–º –≤ `inode`

---

### üì¶ –û–±—ä–µ–∫—Ç—ã:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                       |
| ----------- | -------------------------------- |
| `inode`     | –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –∏ –¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª–∞        |
| `dentry`    | –ó–∞–ø–∏—Å—å –≤ –∫–∞—Ç–∞–ª–æ–≥–µ                |
| `vfs_node`  | –£–∑–µ–ª VFS, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ `inode` |
| `tmpfs_ops` | –ù–∞–±–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å FS    |

---

## üìò –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* [Linux tmpfs design](https://man7.org/linux/man-pages/man5/tmpfs.5.html)
* [OSDev - tmpfs](https://wiki.osdev.org/tmpfs)
* [UNIX File Abstraction Layer](https://en.wikipedia.org/wiki/Inode)

---

## üí° –¶–µ–ª—å –ø—Ä–∞–∫—Ç–∏–∫–∏:

* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å tmpfs: –∫–æ—Ä–Ω–µ–≤–æ–π –∫–∞—Ç–∞–ª–æ–≥, —Ñ–∞–π–ª—ã, –ø–∞–ø–∫–∏
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∞–π–ª–∞ `vfs_create(path)`
* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏—è `vfs_write()`, `vfs_read()`
* –ü—Ä–æ—Å—Ç–∞—è CLI-–∫–æ–º–∞–Ω–¥–∞: `echo`, `cat`, `mkdir`

---

## üíª –ü—Ä–∏–º–µ—Ä—ã –Ω–∞ C23

### `tmpfs.h`

```c
#pragma once

typedef enum { FILE_NODE, DIR_NODE } node_type_t;

typedef struct tmpfs_inode {
    node_type_t type;
    char name[64];
    char* data;
    size_t size;
    struct tmpfs_inode* parent;
    struct tmpfs_inode* children[16];
    size_t child_count;
} tmpfs_inode_t;

void tmpfs_init();
tmpfs_inode_t* tmpfs_create(const char* path, node_type_t type);
tmpfs_inode_t* tmpfs_lookup(const char* path);
int tmpfs_write(tmpfs_inode_t* node, const char* data, size_t len);
int tmpfs_read(tmpfs_inode_t* node, char* buf, size_t max);
```

---

### `tmpfs.c` (—Ñ—Ä–∞–≥–º–µ–Ω—Ç)

```c
#include "tmpfs.h"
#include <string.h>
#include <stdlib.h>
#include <stdio.h>

static tmpfs_inode_t* root = NULL;

void tmpfs_init() {
    root = calloc(1, sizeof(tmpfs_inode_t));
    strcpy(root->name, "/");
    root->type = DIR_NODE;
}

tmpfs_inode_t* tmpfs_create(const char* path, node_type_t type) {
    tmpfs_inode_t* dir = root;  // –ø–æ–∫–∞ –±–µ–∑ –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–æ–≤
    tmpfs_inode_t* file = calloc(1, sizeof(tmpfs_inode_t));
    strcpy(file->name, path);
    file->type = type;
    dir->children[dir->child_count++] = file;
    return file;
}

int tmpfs_write(tmpfs_inode_t* node, const char* data, size_t len) {
    node->data = realloc(node->data, len);
    memcpy(node->data, data, len);
    node->size = len;
    return len;
}

int tmpfs_read(tmpfs_inode_t* node, char* buf, size_t max) {
    size_t to_copy = (node->size < max) ? node->size : max;
    memcpy(buf, node->data, to_copy);
    return to_copy;
}
```

---

### `user_main()`

```c
void user_main() {
    tmpfs_init();
    tmpfs_inode_t* file = tmpfs_create("hello.txt", FILE_NODE);
    tmpfs_write(file, "–ü—Ä–∏–≤–µ—Ç, –º–∏—Ä!\n", 14);

    char buffer[64];
    int len = tmpfs_read(file, buffer, 64);
    buffer[len] = '\0';

    syscall(SYS_WRITE, (uint64_t)buffer, len, 0);
}
```

---

## üß† –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 6.5/10

---

## ‚è± –í—Ä–µ–º—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: 8 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 2 —á
* –†–µ–∞–ª–∏–∑–∞—Ü–∏—è tmpfs: 4 —á
* CLI-–∫–æ–º–∞–Ω–¥—ã: 1.5 —á
* –î–æ–º–∞—à–∫–∞: 0.5 —á

---

## üßë‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* üìö –õ–µ–∫—Ü–∏—è: –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤—ã—Ö —Å–∏—Å—Ç–µ–º
* üé• –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è: tmpfs –≤ Linux (`mount -t tmpfs`)
* üíª –ü—Ä–∞–∫—Ç–∏–∫–∞: —Å–æ–∑–¥–∞—Ç—å –¥–µ—Ä–µ–≤–æ –∫–∞—Ç–∞–ª–æ–≥–æ–≤, –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –∏ —á–∏—Ç–∞—Ç—å
* üìù –î–æ–º–∞—à–∫–∞:

  * –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–æ–¥–∫–∞—Ç–∞–ª–æ–≥–æ–≤
  * –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–¥–∞–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
  * –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `echo "data" > /tmp/myfile`

---

üéâ –ì–æ—Ç–æ–≤ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–≤–Ω—é? –í **–£—Ä–æ–∫–µ 23** –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º **–ø–æ–¥–¥–µ—Ä–∂–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ –º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—ã–µ —Ñ–∞–π–ª–æ–≤—ã–µ —Å–∏—Å—Ç–µ–º—ã**!
–ù–∞–ø–∏—à–∏ **–¥–¥–∞**, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å üíªüì¶.
