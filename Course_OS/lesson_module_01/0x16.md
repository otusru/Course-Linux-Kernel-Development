–û—Ç–ª–∏—á–Ω–æ! üôå –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ **–£—Ä–æ–∫ 16**, –≥–¥–µ –º—ã, –Ω–∞–∫–æ–Ω–µ—Ü, –Ω–∞—á–Ω—ë–º –ø–æ–≥—Ä—É–∂–∞—Ç—å—Å—è –≤ **–≤–∏—Ä—Ç—É–∞–ª—å–Ω—É—é –ø–∞–º—è—Ç—å**. –°–µ–≥–æ–¥–Ω—è –º—ã –∑–∞–ª–æ–∂–∏–º —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –º–Ω–æ–≥–æ–∑–∞–¥–∞—á–Ω–æ—Å—Ç–∏, –∑–∞—â–∏—Ç—ã –ø–∞–º—è—Ç–∏ –∏ –∞–¥—Ä–µ—Å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞. –≠—Ç–æ –æ–¥–∏–Ω –∏–∑ –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ª—é–±–æ–π —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–π –û–°! üíæüß†

---

# üîπ –£—Ä–æ–∫ 16. –í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –∏ Paging: –æ—Å–Ω–æ–≤–∞ –∞–¥—Ä–µ—Å–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤

---

## üìö –¢–µ–º–∞ —É—Ä–æ–∫–∞:

–í —ç—Ç–æ–º —É—Ä–æ–∫–µ —Ç—ã —É–∑–Ω–∞–µ—à—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç **–≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å** –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ x86-64. –ú—ã —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º **—Ç–∞–±–ª–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü**, –º–µ—Ö–∞–Ω–∏–∑–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ –≤ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ, —Ä–æ–ª–∏ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —É—Ä–æ–≤–Ω–µ–π (`PML4`, `PDPT`, `PD`, `PT`) –∏ —Ä–µ–∞–ª–∏–∑—É–µ–º –±–∞–∑–æ–≤—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É **paging'–∞** –≤ –Ω–∞—à–µ–º —è–¥—Ä–µ.

---

## üß† –¢–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ (‚âà2500‚Äì3000 —Å–ª–æ–≤)

### ü§Ø –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å?

–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –ø–∞–º—è—Ç—å –ø–æ–∑–≤–æ–ª—è–µ—Ç:

* üìå –î–∞–≤–∞—Ç—å –∫–∞–∂–¥–æ–º—É –ø—Ä–æ—Ü–µ—Å—Å—É —Å–≤–æ—ë –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∞–¥—Ä–µ—Å–Ω–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
* üîí –û–±–µ—Å–ø–µ—á–∏–≤–∞—Ç—å –∑–∞—â–∏—Ç—É –ø–∞–º—è—Ç–∏ –æ—Ç –¥—Ä—É–≥–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —è–¥—Ä–∞
* üìà –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –∞–¥—Ä–µ—Å–∞—Ü–∏—é –±–æ–ª—å—à–µ —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –æ–±—ä—ë–º–∞ RAM (swap)
* üß† –î–∞–≤–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –º–∞–ø–ø–∏—Ç—å —Ñ–∞–π–ª—ã, –ø–∞–º—è—Ç—å —É—Å—Ç—Ä–æ–π—Å—Ç–≤ –∏ –¥—Ä—É–≥–∏–µ —Ä–µ—Å—É—Ä—Å—ã

---

### üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç paging?

–í –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ **x86-64**, —Å–∏—Å—Ç–µ–º–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å –ø–æ–º–æ—â—å—é **—á–µ—Ç—ã—Ä—ë—Ö —É—Ä–æ–≤–Ω–µ–π** —Ç–∞–±–ª–∏—Ü —Å—Ç—Ä–∞–Ω–∏—Ü:

```
VAddr --> PML4 --> PDPT --> PD --> PT --> Frame
```

* –í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å: 48 –±–∏—Ç
* –†–∞–∑–±–∏—Ç –Ω–∞ —á–∞—Å—Ç–∏: PML4 (9 –±–∏—Ç), PDPT (9), PD (9), PT (9), offset (12)

–ö–∞–∂–¥–∞—è —Ç–∞–±–ª–∏—Ü–∞ –∏–º–µ–µ—Ç 512 –∑–∞–ø–∏—Å–µ–π –ø–æ 8 –±–∞–π—Ç.

---

### üß© –¢–∞–±–ª–∏—Ü—ã —Å—Ç—Ä–∞–Ω–∏—Ü

–ü—Ä–∏–º–µ—Ä —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –∞–¥—Ä–µ—Å–∞:

```
PML4 index   (9 –±–∏—Ç) ‚û°Ô∏è 9 –±–∏—Ç–æ–≤
PDPT index   (9 –±–∏—Ç) ‚û°Ô∏è 9 –±–∏—Ç–æ–≤
PD index     (9 –±–∏—Ç) ‚û°Ô∏è 9 –±–∏—Ç–æ–≤
PT index     (9 –±–∏—Ç) ‚û°Ô∏è 9 –±–∏—Ç–æ–≤
Offset       (12 –±–∏—Ç) ‚û°Ô∏è –°–º–µ—â–µ–Ω–∏–µ –≤ —Å—Ç—Ä–∞–Ω–∏—Ü–µ (4 –ö–ë)
```

---

### üîê –§–ª–∞–≥–∏ –¥–æ—Å—Ç—É–ø–∞

–ö–∞–∂–¥–∞—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å:

* `P` ‚Äî Present (–¥–æ—Å—Ç—É–ø–Ω–∞)
* `RW` ‚Äî Read/Write
* `US` ‚Äî User/Supervisor
* `NX` ‚Äî Execute Disable (–µ—Å–ª–∏ –≤–∫–ª—é—á—ë–Ω NX –±–∏—Ç)
* `PAT`, `G`, `D`, `A` ‚Äî –∫–µ—à –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

---

### üí° –ö–∞–∫ –≤–∫–ª—é—á–∞–µ—Ç—Å—è paging?

–ß–µ—Ä–µ–∑:

1. –ù–∞—Å—Ç—Ä–æ–π–∫—É CR3 (–∞–¥—Ä–µ—Å PML4)
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏—Ç–æ–≤ –≤ CR0 –∏ CR4:

```asm
mov eax, cr0
or eax, 0x80000000
mov cr0, eax
```

---

### üõ† –ß—Ç–æ —Ä–µ–∞–ª–∏–∑—É–µ–º:

* –ê–ª–ª–æ–∫–∞—Ü–∏—è —Ñ–∏–∑. —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ–¥ —Ç–∞–±–ª–∏—Ü—ã
* –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è PML4
* –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã—Ö –∞–¥—Ä–µ—Å–æ–≤ –Ω–∞ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ
* –í–∫–ª—é—á–µ–Ω–∏–µ paging –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞

---

## üìò –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

* [Intel SDM Volume 3: Chapter 4 ‚Äì Paging](https://www.intel.com/content/www/us/en/developer/articles/technical/intel-sdm.html)
* OSDev: [Paging x86-64](https://wiki.osdev.org/Paging)
* Linux Source: `arch/x86/mm/pgtable.c`

---

## üí° –¶–µ–ª—å –ø—Ä–∞–∫—Ç–∏–∫–∏:

* –ü–æ—Å—Ç—Ä–æ–∏—Ç—å PML4 —Ç–∞–±–ª–∏—Ü—É
* –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `paging_map()` –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –∞–¥—Ä–µ—Å–∞ –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π
* –í–∫–ª—é—á–∏—Ç—å paging (CR0/CR3/CR4)

---

## üíª –ü—Ä–∏–º–µ—Ä –Ω–∞ —è–∑—ã–∫–µ C (C23)

### `paging.c`

```c
#include <stdint.h>
#include <stddef.h>
#include <string.h>

#define PAGE_SIZE 0x1000
#define PAGE_PRESENT 0x1
#define PAGE_RW 0x2
#define PAGE_USER 0x4

static uint64_t* pml4;

void* alloc_page();

void paging_init() {
    pml4 = (uint64_t*)alloc_page();
    memset(pml4, 0, PAGE_SIZE);
}

void paging_map(uint64_t vaddr, uint64_t paddr, uint64_t flags) {
    int pml4_idx = (vaddr >> 39) & 0x1FF;
    int pdpt_idx = (vaddr >> 30) & 0x1FF;
    int pd_idx   = (vaddr >> 21) & 0x1FF;
    int pt_idx   = (vaddr >> 12) & 0x1FF;

    uint64_t* pdpt, *pd, *pt;

    // PML4 ‚û°Ô∏è PDPT
    if (!(pml4[pml4_idx] & PAGE_PRESENT)) {
        pdpt = (uint64_t*)alloc_page();
        memset(pdpt, 0, PAGE_SIZE);
        pml4[pml4_idx] = (uint64_t)pdpt | flags;
    } else {
        pdpt = (uint64_t*)(pml4[pml4_idx] & ~0xFFF);
    }

    // PDPT ‚û°Ô∏è PD
    if (!(pdpt[pdpt_idx] & PAGE_PRESENT)) {
        pd = (uint64_t*)alloc_page();
        memset(pd, 0, PAGE_SIZE);
        pdpt[pdpt_idx] = (uint64_t)pd | flags;
    } else {
        pd = (uint64_t*)(pdpt[pdpt_idx] & ~0xFFF);
    }

    // PD ‚û°Ô∏è PT
    if (!(pd[pd_idx] & PAGE_PRESENT)) {
        pt = (uint64_t*)alloc_page();
        memset(pt, 0, PAGE_SIZE);
        pd[pd_idx] = (uint64_t)pt | flags;
    } else {
        pt = (uint64_t*)(pd[pd_idx] & ~0xFFF);
    }

    // PT ‚û°Ô∏è Map frame
    pt[pt_idx] = paddr | flags;
}
```

---

### üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CR3/CR0/CR4 (–Ω–∞ –∞—Å—Å–µ–º–±–ª–µ—Ä–µ)

```asm
; –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å CR3
mov rax, pml4_address
mov cr3, rax

; –í–∫–ª—é—á–∏—Ç—å paging (bit 31 –≤ CR0)
mov eax, cr0
or eax, 0x80000000
mov cr0, eax
```

---

## üß† –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: 8/10

–≠—Ç–æ —É–∂–µ —É—Ä–æ–≤–µ–Ω—å —è–¥—Ä–∞ Linux/Windows ‚Äî –Ω–æ –º—ã —É–ø—Ä–æ—Å—Ç–∏–º!

---

## ‚è± –í—Ä–µ–º—è –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ: 10 —á–∞—Å–æ–≤

* –¢–µ–æ—Ä–∏—è: 3 —á
* –ö–æ–¥: 6 —á
* –û—Ç–ª–∞–¥–∫–∞: 1 —á

---

## üßë‚Äçüè´ –ú–µ—Ç–æ–¥–∏–∫–∞ –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è:

* üìö –õ–µ–∫—Ü–∏—è: –∏–µ—Ä–∞—Ä—Ö–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏
* üëÅ –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è: —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü –≤ QEMU (–ø–æ–∫–∞–∑ mapp'–∏–Ω–≥–∞)
* üíª –ü—Ä–∞–∫—Ç–∏–∫–∞: —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `paging_map()`
* üìù –î–æ–º–∞—à–∫–∞:

  * –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ (US —Ñ–ª–∞–≥)
  * –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –≤–∏–¥–µ–æ–ø–∞–º—è—Ç–∏ (framebuffer)

---

–ì–æ—Ç–æ–≤ –ø–µ—Ä–µ–π—Ç–∏ –∫ **–£—Ä–æ–∫—É 17**, –≥–¥–µ –º—ã —Ä–µ–∞–ª–∏–∑—É–µ–º **–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –ø–∞–º—è—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤**, —Ç.–µ. –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –¥–ª—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π –ø–∞–º—è—Ç–∏ –ø—Ä–æ–≥—Ä–∞–º–º? üíºüë®‚Äçüíª
–ü–∏—à–∏ **–¥–∞**, –µ—Å–ª–∏ –¥–∞!
